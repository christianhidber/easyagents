



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Agents - easyagents</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#module-easyagentsagents" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="easyagents" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              easyagents
            </span>
            <span class="md-header-nav__topic">
              
                Agents
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/christianhidber/easyagents/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    easyagents
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="easyagents" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    easyagents
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/christianhidber/easyagents/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    easyagents
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../CODE_OF_CONDUCT/" title="Code Of Conduct" class="md-nav__link">
      Code Of Conduct
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../CONTRIBUTING/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../documentation/markdown/Release_Notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1" checked>
    
    <label class="md-nav__link" for="nav-5-1">
      Easyagents
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Easyagents
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Agents
      </label>
    
    <a href="./" title="Agents" class="md-nav__link md-nav__link--active">
      Agents
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_backends" class="md-nav__link">
    get_backends
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load" class="md-nav__link">
    load
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register_backend" class="md-nav__link">
    register_backend
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cemagent" class="md-nav__link">
    CemAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#doubledqnagent" class="md-nav__link">
    DoubleDqnAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_1" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_1" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_1" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_1" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dqnagent" class="md-nav__link">
    DqnAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_2" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_2" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_2" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_2" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duelingdqnagent" class="md-nav__link">
    DuelingDqnAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_3" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_3" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_3" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_3" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_3" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_3" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#easyagent" class="md-nav__link">
    EasyAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_4" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants_1" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_4" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_4" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_4" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_4" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_4" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ppoagent" class="md-nav__link">
    PpoAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_5" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_5" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_5" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_5" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_5" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_5" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randomagent" class="md-nav__link">
    RandomAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_6" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_6" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_6" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_6" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_6" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_6" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reinforceagent" class="md-nav__link">
    ReinforceAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_7" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_7" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_7" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_7" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_7" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_7" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sacagent" class="md-nav__link">
    SacAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_8" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_8" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_8" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_8" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_8" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_8" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core/" title="Core" class="md-nav__link">
      Core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1-3" type="checkbox" id="nav-5-1-3">
    
    <label class="md-nav__link" for="nav-5-1-3">
      Backends
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-1-3">
        Backends
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../backends/core/" title="Core" class="md-nav__link">
      Core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../backends/tfagents/" title="Tfagents" class="md-nav__link">
      Tfagents
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1-4" type="checkbox" id="nav-5-1-4">
    
    <label class="md-nav__link" for="nav-5-1-4">
      Callbacks
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-1-4">
        Callbacks
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../callbacks/duration/" title="Duration" class="md-nav__link">
      Duration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../callbacks/log/" title="Log" class="md-nav__link">
      Log
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../callbacks/plot/" title="Plot" class="md-nav__link">
      Plot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../callbacks/save/" title="Save" class="md-nav__link">
      Save
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_backends" class="md-nav__link">
    get_backends
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load" class="md-nav__link">
    load
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register_backend" class="md-nav__link">
    register_backend
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cemagent" class="md-nav__link">
    CemAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#doubledqnagent" class="md-nav__link">
    DoubleDqnAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_1" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_1" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_1" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_1" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dqnagent" class="md-nav__link">
    DqnAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_2" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_2" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_2" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_2" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duelingdqnagent" class="md-nav__link">
    DuelingDqnAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_3" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_3" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_3" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_3" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_3" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_3" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#easyagent" class="md-nav__link">
    EasyAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_4" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants_1" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_4" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_4" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_4" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_4" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_4" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ppoagent" class="md-nav__link">
    PpoAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_5" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_5" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_5" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_5" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_5" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_5" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randomagent" class="md-nav__link">
    RandomAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_6" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_6" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_6" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_6" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_6" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_6" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reinforceagent" class="md-nav__link">
    ReinforceAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_7" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_7" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_7" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_7" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_7" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_7" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sacagent" class="md-nav__link">
    SacAgent
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_8" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_8" class="md-nav__link">
    Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evaluate_8" class="md-nav__link">
    evaluate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#play_8" class="md-nav__link">
    play
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save_8" class="md-nav__link">
    save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#train_8" class="md-nav__link">
    train
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/christianhidber/easyagents/edit/master/reference/easyagents/agents.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="module-easyagentsagents">Module easyagents.agents</h1>
<p>This module contains the public api of the EasyAgents reinforcement learning library.</p>
<p>It consist mainly of the class hierarchy of the available agents (algorithms), registrations and
the management of the available backends. In their implementation the agents forward their calls
to the chosen backend.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;This module contains the public api of the EasyAgents reinforcement learning library.</span>

<span class="sd">    It consist mainly of the class hierarchy of the available agents (algorithms), registrations and</span>

<span class="sd">    the management of the available backends. In their implementation the agents forward their calls</span>

<span class="sd">    to the chosen backend.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">statistics</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">easyagents</span> <span class="kn">import</span> <span class="n">core</span>

<span class="kn">from</span> <span class="nn">easyagents.backends</span> <span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">bcore</span>

<span class="kn">from</span> <span class="nn">easyagents.callbacks</span> <span class="kn">import</span> <span class="n">plot</span>

<span class="kn">import</span> <span class="nn">easyagents.backends.default</span>

<span class="c1"># import easyagents.backends.kerasrl</span>

<span class="kn">import</span> <span class="nn">easyagents.backends.tfagents</span>

<span class="c1"># import easyagents.backends.tforce</span>

<span class="n">_backends</span><span class="p">:</span> <span class="p">[</span><span class="n">bcore</span><span class="o">.</span><span class="n">BackendAgentFactory</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="sd">&quot;&quot;&quot;The seed used for all agents and gym environments. If None no seed is set (default).&quot;&quot;&quot;</span>

<span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>

         <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Loads an agent from directory.</span>

<span class="sd">    After a successful load play() may be called directly.</span>

<span class="sd">    The agent, model, backend, seed and play policy are restored according to the previously saved agent.</span>

<span class="sd">    Args:</span>

<span class="sd">        directory: the directory containing the previously saved policy.</span>

<span class="sd">        callbacks: list of callbacks called during save (eg log.Agent)</span>

<span class="sd">    Result:</span>

<span class="sd">        a new instance of EasyAgents</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">directory</span>

    <span class="n">agent_json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_EASYAGENT_FILENAME</span><span class="p">)</span>

    <span class="n">policy_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_POLICY_DIRECTORY</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span> <span class="n">f</span><span class="s1">&#39;directory &quot;{directory}&quot; not found.&#39;</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">agent_json_path</span><span class="p">),</span> <span class="s1">&#39;file &quot;{agent_json_path}&quot; not found.&#39;</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">policy_directory</span><span class="p">),</span> <span class="n">f</span><span class="s1">&#39;directory &quot;{policy_directory}&quot; not found.&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">agent_json_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonfile</span><span class="p">:</span>

        <span class="n">agent_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">jsonfile</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">EasyAgent</span><span class="o">.</span><span class="n">_from_dict</span><span class="p">(</span><span class="n">agent_dict</span><span class="p">)</span>

    <span class="n">callbacks</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">_to_callback_list</span><span class="p">(</span><span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

    <span class="n">result</span><span class="o">.</span><span class="n">_backend_agent</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">policy_directory</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">register_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">:</span> <span class="n">bcore</span><span class="o">.</span><span class="n">BackendAgentFactory</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;registers a backend as a factory for agent implementations.</span>

<span class="sd">    If another backend with the same name is already registered, the old backend is replaced by backend.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">backend</span>

    <span class="n">old_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">_backends</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">backend_name</span> <span class="o">==</span> <span class="n">backend</span><span class="o">.</span><span class="n">backend_name</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">old_backend</span> <span class="ow">in</span> <span class="n">old_backends</span><span class="p">:</span>

        <span class="n">_backends</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">old_backend</span><span class="p">)</span>

    <span class="n">_backends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

<span class="c1"># register all backends deployed with easyagents</span>

<span class="n">register_backend</span><span class="p">(</span><span class="n">easyagents</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">BackendAgentFactory</span><span class="p">())</span>

<span class="n">register_backend</span><span class="p">(</span><span class="n">easyagents</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">tfagents</span><span class="o">.</span><span class="n">TfAgentAgentFactory</span><span class="p">())</span>

<span class="c1"># register_backend(easyagents.backends.tforce.TensorforceAgentFactory())</span>

<span class="c1"># register_backend(easyagents.backends.kerasrl.KerasRlAgentFactory())</span>

<span class="k">class</span> <span class="nc">EasyAgent</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Abstract base class for all easy reinforcment learning agents.</span>

<span class="sd">    Besides forwarding train and play it implements persistence.&quot;&quot;&quot;</span>

    <span class="n">_KEY_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;backend&#39;</span>

    <span class="n">_KEY_EASYAGENT_CLASS</span> <span class="o">=</span> <span class="s1">&#39;easyagent_class&#39;</span>

    <span class="n">_KEY_EASYAGENT_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;easyagent.json&#39;</span>

    <span class="n">_KEY_MODEL_CONFIG</span> <span class="o">=</span> <span class="s1">&#39;model_config&#39;</span>

    <span class="n">_KEY_POLICY_DIRECTORY</span> <span class="o">=</span> <span class="s1">&#39;policy&#39;</span>

    <span class="n">_KEY_VERSION</span> <span class="o">=</span> <span class="s1">&#39;version&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

                 <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>

                 <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

                 <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">            Args:</span>

<span class="sd">                gym_env_name: name of an OpenAI gym environment to be used for training and evaluation</span>

<span class="sd">                fc_layers: defines the neural network to be used, a sequence of fully connected</span>

<span class="sd">                    layers of the given size. Eg (75,40) yields a neural network consisting</span>

<span class="sd">                    out of 2 hidden layers, the first one containing 75 and the second layer</span>

<span class="sd">                    containing 40 neurons.</span>

<span class="sd">                backend=the backend to be used (eg &#39;tfagents&#39;), if None a default implementation is used.</span>

<span class="sd">                    call get_backends() to get a list of the available backends.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">model_config</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">ModelConfig</span><span class="p">(</span><span class="n">gym_env_name</span><span class="o">=</span><span class="n">gym_env_name</span><span class="p">,</span> <span class="n">fc_layers</span><span class="o">=</span><span class="n">fc_layers</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="n">model_config</span><span class="o">=</span><span class="n">model_config</span><span class="p">,</span> <span class="n">backend_name</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>

        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_config</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">ModelConfig</span><span class="p">,</span> <span class="n">backend_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">backend_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">backend_name</span> <span class="o">=</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">BackendAgentFactory</span><span class="o">.</span><span class="n">backend_name</span>

        <span class="n">backend</span><span class="p">:</span> <span class="n">bcore</span><span class="o">.</span><span class="n">BackendAgentFactory</span> <span class="o">=</span> <span class="n">_get_backend</span><span class="p">(</span><span class="n">backend_name</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">model_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;model_config not set.&quot;</span>

        <span class="k">assert</span> <span class="n">backend</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Backend &quot;{backend_name}&quot; not found. The registered backends are {get_backends()}.&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">ModelConfig</span> <span class="o">=</span> <span class="n">model_config</span>

        <span class="n">backend_agent</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">create_agent</span><span class="p">(</span><span class="n">easyagent_type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">model_config</span><span class="o">=</span><span class="n">model_config</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">backend_agent</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;Backend &quot;{backend_name}&quot; does not implement &quot;{type(self).__name__}&quot;. &#39;</span> <span class="o">+</span> \

                              <span class="n">f</span><span class="s1">&#39;Choose one of the following backend {get_backends(type(self))}.&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_agent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">bcore</span><span class="o">.</span><span class="n">_BackendAgent</span><span class="p">]</span> <span class="o">=</span> <span class="n">backend_agent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">backend_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_agent</span><span class="o">.</span><span class="n">_agent_context</span><span class="o">.</span><span class="n">_agent_saver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span>

        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_add_plot_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbacks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span>

                            <span class="n">default_plots</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>

                            <span class="n">default_plot_callbacks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">plot</span><span class="o">.</span><span class="n">_PlotCallback</span><span class="p">]</span>

                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;Adds the default callbacks and sorts all callbacks in the order</span>

<span class="sd">            _PreProcessCallbacks, AgentCallbacks, _PostProcessCallbacks.</span>

<span class="sd">        Args:</span>

<span class="sd">            callbacks: existing callbacks to prepare</span>

<span class="sd">            default_plots: if set or if None and callbacks does not contain plots then the default plots are added</span>

<span class="sd">            default_plot_callbacks: plot callbacks to add.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pre_process</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">()]</span>

        <span class="n">agent</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">post_process</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">()]</span>

        <span class="k">if</span> <span class="n">default_plots</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">default_plots</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">:</span>

                <span class="n">default_plots</span> <span class="o">=</span> <span class="n">default_plots</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">plot</span><span class="o">.</span><span class="n">_PlotCallback</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">default_plots</span><span class="p">:</span>

            <span class="n">agent</span> <span class="o">=</span> <span class="n">default_plot_callbacks</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">_PreProcessCallback</span><span class="p">):</span>

                <span class="n">pre_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">_PostProcessCallback</span><span class="p">):</span>

                    <span class="n">post_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">agent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre_process</span> <span class="o">+</span> <span class="n">agent</span> <span class="o">+</span> <span class="n">post_process</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@staticmethod</span>

    <span class="k">def</span> <span class="nf">_from_dict</span><span class="p">(</span><span class="n">param_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]):</span>

        <span class="sd">&quot;&quot;&quot;recreates a new agent instance according to the definition previously created by _to_dict.</span>

<span class="sd">        Returns:</span>

<span class="sd">            new agent instance (excluding any trained policy), the agent type is preserved.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">param_dict</span>

        <span class="n">mc</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">ModelConfig</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">ModelConfig</span><span class="o">.</span><span class="n">_from_dict</span><span class="p">(</span><span class="n">param_dict</span><span class="p">[</span><span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_MODEL_CONFIG</span><span class="p">])</span>

        <span class="n">agent_class</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">param_dict</span><span class="p">[</span><span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_EASYAGENT_CLASS</span><span class="p">]]</span>

        <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">param_dict</span><span class="p">[</span><span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_BACKEND</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">agent_class</span><span class="p">(</span><span class="n">gym_env_name</span><span class="o">=</span><span class="n">mc</span><span class="o">.</span><span class="n">original_env_name</span><span class="p">)</span>

        <span class="n">result</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="n">model_config</span><span class="o">=</span><span class="n">mc</span><span class="p">,</span> <span class="n">backend_name</span><span class="o">=</span><span class="n">backend</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_to_callback_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span>

        <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;maps callbacks to an admissible callback list.</span>

<span class="sd">        if callbacks is None an empty list is returned.</span>

<span class="sd">        if callbacks is an AgentCallback a list containing only this callback is returned</span>

<span class="sd">        otherwise callbacks is returned</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">callbacks</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">):</span>

                <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">callbacks</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;callback not an AgentCallback or a list thereof.&quot;</span>

                <span class="n">result</span> <span class="o">=</span> <span class="n">callbacks</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;saves the agent definition to a dict.</span>

<span class="sd">            Returns:</span>

<span class="sd">                dict containing all parameters to recreate the agent (excluding a trained policy)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">string</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">result</span><span class="p">[</span><span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_VERSION</span><span class="p">]</span> <span class="o">=</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">__version__</span>

        <span class="n">result</span><span class="p">[</span><span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_EASYAGENT_CLASS</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="n">result</span><span class="p">[</span><span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_BACKEND</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend_name</span>

        <span class="n">result</span><span class="p">[</span><span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_MODEL_CONFIG</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_config</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">()</span>

        <span class="n">result</span><span class="p">[</span><span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_POLICY_DIRECTORY</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;policy&#39;</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

                 <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

                 <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Plays num_episodes with the current policy and computes metrics on rewards.</span>

<span class="sd">        Args:</span>

<span class="sd">            num_episodes: number of episodes to play</span>

<span class="sd">            max_steps_per_episode: max steps per episode</span>

<span class="sd">        Returns:</span>

<span class="sd">            extensible score metrics</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">play_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span><span class="p">()</span>

        <span class="n">play_context</span><span class="o">.</span><span class="n">max_steps_per_episode</span> <span class="o">=</span> <span class="n">max_steps_per_episode</span>

        <span class="n">play_context</span><span class="o">.</span><span class="n">num_episodes</span> <span class="o">=</span> <span class="n">num_episodes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">play_context</span><span class="o">=</span><span class="n">play_context</span><span class="p">,</span> <span class="n">default_plots</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">Metrics</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Metrics&#39;</span><span class="p">,</span> <span class="s1">&#39;steps rewards&#39;</span><span class="p">)</span>

        <span class="n">Rewards</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Rewards&#39;</span><span class="p">,</span> <span class="s1">&#39;mean std min max all&#39;</span><span class="p">)</span>

        <span class="n">all_rewards</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">play_context</span><span class="o">.</span><span class="n">sum_of_rewards</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="n">mean_reward</span><span class="p">,</span> <span class="n">std_reward</span><span class="p">,</span> <span class="n">min_reward</span><span class="p">,</span> <span class="n">max_reward</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">all_rewards</span><span class="p">),</span> <span class="n">statistics</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span>

            <span class="n">all_rewards</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">all_rewards</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_rewards</span><span class="p">)</span>

        <span class="n">rewards</span> <span class="o">=</span> <span class="n">Rewards</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">mean_reward</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="n">std_reward</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_reward</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_reward</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="n">all_rewards</span><span class="p">)</span>

        <span class="n">Steps</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Steps&#39;</span><span class="p">,</span> <span class="s1">&#39;mean std min max all&#39;</span><span class="p">)</span>

        <span class="n">all_num_steps</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">play_context</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="n">all_num_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">play_context</span><span class="o">.</span><span class="n">rewards</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="n">mean_steps</span><span class="p">,</span> <span class="n">std_steps</span><span class="p">,</span> <span class="n">min_steps</span><span class="p">,</span> <span class="n">max_steps</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">all_num_steps</span><span class="p">),</span> <span class="n">statistics</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span>

            <span class="n">all_num_steps</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">all_num_steps</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_num_steps</span><span class="p">)</span>

        <span class="n">steps</span> <span class="o">=</span> <span class="n">Steps</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">mean_steps</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="n">std_steps</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_steps</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="n">all_num_steps</span><span class="p">)</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="n">Metrics</span><span class="p">(</span><span class="n">rewards</span><span class="o">=</span><span class="n">rewards</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">metrics</span>

    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

             <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

             <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

             <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

             <span class="n">play_context</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

             <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Plays num_episodes with the current policy.</span>

<span class="sd">        Args:</span>

<span class="sd">            callbacks: list of callbacks called during each episode play</span>

<span class="sd">            num_episodes: number of episodes to play</span>

<span class="sd">            max_steps_per_episode: max steps per episode</span>

<span class="sd">            play_context: play configuration to be used. If set override all other play context arguments</span>

<span class="sd">            default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</span>

<span class="sd">        Returns:</span>

<span class="sd">            play_context containg the actions taken and the rewards received during training</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend_agent</span><span class="o">.</span><span class="n">_agent_context</span><span class="o">.</span><span class="n">_is_policy_trained</span><span class="p">,</span> <span class="s2">&quot;No trained policy available. Call train() first.&quot;</span>

        <span class="k">if</span> <span class="n">play_context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">play_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span><span class="p">()</span>

            <span class="n">play_context</span><span class="o">.</span><span class="n">max_steps_per_episode</span> <span class="o">=</span> <span class="n">max_steps_per_episode</span>

            <span class="n">play_context</span><span class="o">.</span><span class="n">num_episodes</span> <span class="o">=</span> <span class="n">num_episodes</span>

        <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_callback_list</span><span class="p">(</span><span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

        <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_plot_callbacks</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">default_plots</span><span class="p">,</span> <span class="p">[</span><span class="n">plot</span><span class="o">.</span><span class="n">Steps</span><span class="p">(),</span> <span class="n">plot</span><span class="o">.</span><span class="n">Rewards</span><span class="p">()])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_agent</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">play_context</span><span class="o">=</span><span class="n">play_context</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">play_context</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

             <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot;Saves the currently trained actor policy in directory.</span>

<span class="sd">        If save is called before a trained policy is created, eg by calling train, an exception is raised.</span>

<span class="sd">        Args:</span>

<span class="sd">             directory: the directory to save the policy weights to.</span>

<span class="sd">                if the directory does not exist yet, a new directory is created. if None the policy is saved</span>

<span class="sd">                in a temp directory.</span>

<span class="sd">             callbacks: list of callbacks called during save (eg log.Agent)</span>

<span class="sd">        Returns:</span>

<span class="sd">            the absolute path to the directory containing the saved policy.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">directory</span> <span class="o">=</span> <span class="n">bcore</span><span class="o">.</span><span class="n">_get_temp_path</span><span class="p">()</span>

        <span class="k">assert</span> <span class="n">directory</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend_agent</span><span class="o">.</span><span class="n">_agent_context</span><span class="o">.</span><span class="n">_is_policy_trained</span><span class="p">,</span> <span class="s2">&quot;No trained policy available. Call train() first.&quot;</span>

        <span class="n">directory</span> <span class="o">=</span> <span class="n">bcore</span><span class="o">.</span><span class="n">_mkdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="n">agent_json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_EASYAGENT_FILENAME</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">agent_json_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonfile</span><span class="p">:</span>

            <span class="n">agent_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">()</span>

            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">agent_dict</span><span class="p">,</span> <span class="n">jsonfile</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_callback_list</span><span class="p">(</span><span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

        <span class="n">policy_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">EasyAgent</span><span class="o">.</span><span class="n">_KEY_POLICY_DIRECTORY</span><span class="p">)</span>

        <span class="n">policy_directory</span> <span class="o">=</span> <span class="n">bcore</span><span class="o">.</span><span class="n">_mkdir</span><span class="p">(</span><span class="n">policy_directory</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_agent</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">policy_directory</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">directory</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_context</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">TrainContext</span><span class="p">,</span>

              <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>

              <span class="n">default_plots</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]):</span>

        <span class="sd">&quot;&quot;&quot;Trains a new model using the gym environment passed during instantiation.</span>

<span class="sd">        Args:</span>

<span class="sd">            callbacks: list of callbacks called during the training and evaluation</span>

<span class="sd">            train_context: training configuration to be used (num_iterations,num_episodes_per_iteration,...)</span>

<span class="sd">            default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).</span>

<span class="sd">                if None default callbacks are only added if the callbacks list is empty</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">train_context</span><span class="p">,</span> <span class="s2">&quot;train_context not set.&quot;</span>

        <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_callback_list</span><span class="p">(</span><span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

        <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_plot_callbacks</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">default_plots</span><span class="p">,</span> <span class="p">[</span><span class="n">plot</span><span class="o">.</span><span class="n">Loss</span><span class="p">(),</span> <span class="n">plot</span><span class="o">.</span><span class="n">Steps</span><span class="p">(),</span> <span class="n">plot</span><span class="o">.</span><span class="n">Rewards</span><span class="p">()])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_agent</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_context</span><span class="o">=</span><span class="n">train_context</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_backends</span><span class="p">(</span><span class="n">agent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">EasyAgent</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">skip_v1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;returns a list of all registered backends containing an implementation for the EasyAgent type agent.</span>

<span class="sd">    Args:</span>

<span class="sd">        agent: type deriving from EasyAgent for which the backend identifiers are returned.</span>

<span class="sd">        skip_v1: if set only backends compatible with tensorflow v2 compatibility mode and eager execution</span>

<span class="sd">            are returned.</span>

<span class="sd">    Returns:</span>

<span class="sd">        a list of admissible values for the &#39;backend&#39; argument of EazyAgents constructors or a list of all</span>

<span class="sd">        available backends if agent is None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">_backends</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_v1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">b</span><span class="o">.</span><span class="n">tensorflow_v2_eager_compatible</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">backend_name</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">backends</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">agent</span><span class="p">:</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">backend_name</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">backends</span> <span class="k">if</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">get_algorithms</span><span class="p">()]</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">_get_backend</span><span class="p">(</span><span class="n">backend_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Yields the backend with the given name.</span>

<span class="sd">    Returns:</span>

<span class="sd">        the backend instance or None if no backend is found.&quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">backend_name</span>

    <span class="n">backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">_backends</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">backend_name</span> <span class="o">==</span> <span class="n">backend_name</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">backends</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;no backend found with name &quot;{backend_name}&quot;. Available backends = {get_backends()}&#39;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">backends</span><span class="p">:</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">backends</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span> <span class="nc">CemAgent</span><span class="p">(</span><span class="n">EasyAgent</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;creates a new agent based on the cross-entropy-method algorithm.</span>

<span class="sd">       From https://learning.mpi-sws.org/mlss2016/slides/2016-MLSS-RL.pdf:</span>

<span class="sd">        Initialize µ ∈Rd,σ ∈Rd</span>

<span class="sd">        for iteration = 1,2,... num_iterations do</span>

<span class="sd">            Collect num_episodes_per_iteration samples of θi ∼ N(µ,diag(σ))</span>

<span class="sd">            Perform a noisy evaluation Ri ∼ θi</span>

<span class="sd">            Select the top elite_set_fraction of samples (e.g. p = 0.2), which we’ll call the elite set</span>

<span class="sd">            Fit a Gaussian distribution, with diagonal covariance, to the elite set, obtaining a new µ,σ.</span>

<span class="sd">        end for</span>

<span class="sd">        Return the ﬁnal µ.</span>

<span class="sd">        see https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.81.6579&amp;rep=rep1&amp;type=pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

                 <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>

                 <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

                 <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;CemAgent is currently not available (pending migration of keras-rl to tf2.0)&quot;</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

              <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

              <span class="n">num_episodes_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

              <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

              <span class="n">elite_set_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>

              <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

              <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">train_context</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">CemTrainContext</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Trains a new model using the gym environment passed during instantiation.</span>

<span class="sd">        Args:</span>

<span class="sd">            callbacks: list of callbacks called during training and evaluation</span>

<span class="sd">            num_iterations: number of times the training is repeated (with additional data)</span>

<span class="sd">            num_episodes_per_iteration: number of episodes played in each iteration. for each episode a new</span>

<span class="sd">                policy is sampled from the current weight distribution.</span>

<span class="sd">            max_steps_per_episode: maximum number of steps per episode</span>

<span class="sd">            elite_set_fraction: the fraction of policies which are members of the elite set.</span>

<span class="sd">                These policies are used to fit a new weight distribution in each iteration.</span>

<span class="sd">            num_iterations_between_eval: number of training iterations before the current policy is evaluated.</span>

<span class="sd">                if 0 no evaluation is performed.</span>

<span class="sd">            num_episodes_per_eval: number of episodes played to estimate the average return and steps</span>

<span class="sd">            train_context: training configuration to be used. if set overrides all other training context arguments.</span>

<span class="sd">            default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).</span>

<span class="sd">                if None default callbacks are only added if the callbacks list is empty</span>

<span class="sd">        Returns:</span>

<span class="sd">            train_context: the training configuration containing the loss and sum of rewards encountered</span>

<span class="sd">                during training</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">train_context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">train_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">CemTrainContext</span><span class="p">()</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations</span> <span class="o">=</span> <span class="n">num_iterations</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">max_steps_per_episode</span> <span class="o">=</span> <span class="n">max_steps_per_episode</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">elite_set_fraction</span> <span class="o">=</span> <span class="n">elite_set_fraction</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations_between_eval</span> <span class="o">=</span> <span class="n">num_iterations_between_eval</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_episodes_per_eval</span> <span class="o">=</span> <span class="n">num_episodes_per_eval</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_context</span><span class="o">=</span><span class="n">train_context</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">default_plots</span><span class="o">=</span><span class="n">default_plots</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">train_context</span>

<span class="k">class</span> <span class="nc">DqnAgent</span><span class="p">(</span><span class="n">EasyAgent</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;creates a new agent based on the Dqn algorithm.</span>

<span class="sd">    From wikipedia:</span>

<span class="sd">    The DeepMind system used a deep convolutional neural network, with layers of tiled convolutional filters to mimic</span>

<span class="sd">    the effects of receptive fields. Reinforcement learning is unstable or divergent when a nonlinear function</span>

<span class="sd">    approximator such as a neural network is used to represent Q.</span>

<span class="sd">    This instability comes from the correlations present in the sequence of observations, the fact that small updates</span>

<span class="sd">    to Q may significantly change the policy and the data distribution, and the correlations between Q and the</span>

<span class="sd">    target values.</span>

<span class="sd">    The technique used experience replay, a biologically inspired mechanism that uses a random sample of prior actions</span>

<span class="sd">    instead of the most recent action to proceed.[2] This removes correlations in the observation sequence and smooths</span>

<span class="sd">    changes in the data distribution. Iterative update adjusts Q towards target values that are only periodically</span>

<span class="sd">    updated, further reducing correlations with the target.[17]</span>

<span class="sd">    see also: https://deepmind.com/research/publications/human-level-control-through-deep-reinforcement-learning</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

              <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>

              <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

              <span class="n">num_steps_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

              <span class="n">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>

              <span class="n">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>

              <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

              <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>

              <span class="n">train_context</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">StepsTrainContext</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Trains a new model using the gym environment passed during instantiation.</span>

<span class="sd">        Args:</span>

<span class="sd">            callbacks: list of callbacks called during training and evaluation</span>

<span class="sd">            num_iterations: number of times the training is repeated (with additional data)</span>

<span class="sd">            max_steps_per_episode: maximum number of steps per episode</span>

<span class="sd">            num_steps_per_iteration: number of steps played per training iteration</span>

<span class="sd">            num_steps_buffer_preload: number of initial collect steps to preload the buffer</span>

<span class="sd">            num_steps_sampled_from_buffer: the number of steps sampled from buffer for each iteration training</span>

<span class="sd">            num_iterations_between_eval: number of training iterations before the current policy is evaluated.</span>

<span class="sd">                if 0 no evaluation is performed.</span>

<span class="sd">            num_episodes_per_eval: number of episodes played to estimate the average return and steps</span>

<span class="sd">            learning_rate: the learning rate used in the next iteration&#39;s policy training (0,1]</span>

<span class="sd">            train_context: training configuration to be used. if set overrides all other training context arguments.</span>

<span class="sd">            default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).</span>

<span class="sd">                if None default callbacks are only added if the callbacks list is empty</span>

<span class="sd">        Returns:</span>

<span class="sd">            train_context: the training configuration containing the loss and sum of rewards encountered</span>

<span class="sd">                during training</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">train_context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">train_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">StepsTrainContext</span><span class="p">()</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations</span> <span class="o">=</span> <span class="n">num_iterations</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">max_steps_per_episode</span> <span class="o">=</span> <span class="n">max_steps_per_episode</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_steps_per_iteration</span> <span class="o">=</span> <span class="n">num_steps_per_iteration</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_steps_buffer_preload</span> <span class="o">=</span> <span class="n">num_steps_buffer_preload</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_steps_sampled_from_buffer</span> <span class="o">=</span> <span class="n">num_steps_sampled_from_buffer</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations_between_eval</span> <span class="o">=</span> <span class="n">num_iterations_between_eval</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_episodes_per_eval</span> <span class="o">=</span> <span class="n">num_episodes_per_eval</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_context</span><span class="o">=</span><span class="n">train_context</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">default_plots</span><span class="o">=</span><span class="n">default_plots</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">train_context</span>

<span class="k">class</span> <span class="nc">DoubleDqnAgent</span><span class="p">(</span><span class="n">DqnAgent</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Agent based on the Double Dqn algorithm (https://arxiv.org/abs/1509.06461)&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

                 <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>

                 <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

                 <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;DoubleDqnAgent is currently not available (pending migration of tensorforce/keras-rl to tf2.0)&quot;</span>

<span class="k">class</span> <span class="nc">DuelingDqnAgent</span><span class="p">(</span><span class="n">DqnAgent</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Agent based on the Dueling Dqn algorithm (https://arxiv.org/abs/1511.06581).&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

             <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>

             <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

             <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

    <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;DuelingDqnAgent is currently not available (pending migration of tensorforce/keras-rl to tf2.0)&quot;</span>

<span class="k">class</span> <span class="nc">PpoAgent</span><span class="p">(</span><span class="n">EasyAgent</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;creates a new agent based on the PPO algorithm.</span>

<span class="sd">        PPO is an actor-critic algorithm using 2 neural networks. The actor network</span>

<span class="sd">        to predict the next action to be taken and the critic network to estimate</span>

<span class="sd">        the value of the game state we are currently in (the expected, discounted</span>

<span class="sd">        sum of future rewards when following the current actor network).</span>

<span class="sd">        see also: https://spinningup.openai.com/en/latest/algorithms/ppo.html</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

              <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

              <span class="n">num_episodes_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

              <span class="n">num_epochs_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

              <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>

              <span class="n">train_context</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">PpoTrainContext</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Trains a new model using the gym environment passed during instantiation.</span>

<span class="sd">        Args:</span>

<span class="sd">            callbacks: list of callbacks called during training and evaluation</span>

<span class="sd">            num_iterations: number of times the training is repeated (with additional data)</span>

<span class="sd">            num_episodes_per_iteration: number of episodes played per training iteration</span>

<span class="sd">            max_steps_per_episode: maximum number of steps per episode</span>

<span class="sd">            num_epochs_per_iteration: number of times the data collected for the current iteration</span>

<span class="sd">                is used to retrain the current policy</span>

<span class="sd">            num_iterations_between_eval: number of training iterations before the current policy is evaluated.</span>

<span class="sd">                if 0 no evaluation is performed.</span>

<span class="sd">            num_episodes_per_eval: number of episodes played to estimate the average return and steps</span>

<span class="sd">            learning_rate: the learning rate used in the next iteration&#39;s policy training (0,1]</span>

<span class="sd">            train_context: training configuration to be used. if set overrides all other training context arguments.</span>

<span class="sd">            default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).</span>

<span class="sd">                if None default callbacks are only added if the callbacks list is empty</span>

<span class="sd">        Returns:</span>

<span class="sd">            train_context: the training configuration containing the loss and sum of rewards encountered</span>

<span class="sd">                during training</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">train_context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">train_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">PpoTrainContext</span><span class="p">()</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations</span> <span class="o">=</span> <span class="n">num_iterations</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_episodes_per_iteration</span> <span class="o">=</span> <span class="n">num_episodes_per_iteration</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">max_steps_per_episode</span> <span class="o">=</span> <span class="n">max_steps_per_episode</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_epochs_per_iteration</span> <span class="o">=</span> <span class="n">num_epochs_per_iteration</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations_between_eval</span> <span class="o">=</span> <span class="n">num_iterations_between_eval</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_episodes_per_eval</span> <span class="o">=</span> <span class="n">num_episodes_per_eval</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_context</span><span class="o">=</span><span class="n">train_context</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">default_plots</span><span class="o">=</span><span class="n">default_plots</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">train_context</span>

<span class="k">class</span> <span class="nc">RandomAgent</span><span class="p">(</span><span class="n">EasyAgent</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Agent which always chooses uniform random actions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

              <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>

              <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">train_context</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">TrainContext</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Evaluates the environment using a uniform random policy.</span>

<span class="sd">        The evaluation is performed in batches of num_episodes_per_eval episodes.</span>

<span class="sd">        Args:</span>

<span class="sd">            callbacks: list of callbacks called during training and evaluation</span>

<span class="sd">            num_iterations: number of times a batch of num_episodes_per_eval episodes is evaluated.</span>

<span class="sd">            max_steps_per_episode: maximum number of steps per episode</span>

<span class="sd">            num_episodes_per_eval: number of episodes played to estimate the average return and steps</span>

<span class="sd">            train_context: training configuration to be used. if set overrides all other training context arguments.</span>

<span class="sd">            default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...)</span>

<span class="sd">        Returns:</span>

<span class="sd">            train_context: the training configuration containing the loss and sum of rewards encountered</span>

<span class="sd">                during training</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">train_context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">train_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">TrainContext</span><span class="p">()</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations</span> <span class="o">=</span> <span class="n">num_iterations</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">max_steps_per_episode</span> <span class="o">=</span> <span class="n">max_steps_per_episode</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_epochs_per_iteration</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations_between_eval</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_episodes_per_eval</span> <span class="o">=</span> <span class="n">num_episodes_per_eval</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_context</span><span class="o">=</span><span class="n">train_context</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">default_plots</span><span class="o">=</span><span class="n">default_plots</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">train_context</span>

<span class="k">class</span> <span class="nc">ReinforceAgent</span><span class="p">(</span><span class="n">EasyAgent</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;creates a new agent based on the Reinforce algorithm.</span>

<span class="sd">        Reinforce is a vanilla policy gradient algorithm using a single actor network.</span>

<span class="sd">        see also: www-anw.cs.umass.edu/~barto/courses/cs687/williams92simple.pdf</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>

              <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

              <span class="n">num_episodes_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>

              <span class="n">num_epochs_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

              <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

              <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>

              <span class="n">train_context</span><span class="p">:</span> <span class="n">core</span><span class="o">.</span><span class="n">EpisodesTrainContext</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>

              <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Trains a new model using the gym environment passed during instantiation.</span>

<span class="sd">        Args:</span>

<span class="sd">            callbacks: list of callbacks called during training and evaluation</span>

<span class="sd">            num_iterations: number of times the training is repeated (with additional data)</span>

<span class="sd">            num_episodes_per_iteration: number of episodes played per training iteration</span>

<span class="sd">            max_steps_per_episode: maximum number of steps per episode</span>

<span class="sd">            num_epochs_per_iteration: number of times the data collected for the current iteration</span>

<span class="sd">                is used to retrain the current policy</span>

<span class="sd">            num_iterations_between_eval: number of training iterations before the current policy is evaluated.</span>

<span class="sd">                if 0 no evaluation is performed.</span>

<span class="sd">            num_episodes_per_eval: number of episodes played to estimate the average return and steps</span>

<span class="sd">            learning_rate: the learning rate used in the next iteration&#39;s policy training (0,1]</span>

<span class="sd">            train_context: training configuration to be used. if set overrides all other training context arguments.</span>

<span class="sd">            default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).</span>

<span class="sd">                if None default callbacks are only added if the callbacks list is empty</span>

<span class="sd">        Returns:</span>

<span class="sd">            train_context: the training configuration containing the loss and sum of rewards encountered</span>

<span class="sd">                during training</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">train_context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">train_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">EpisodesTrainContext</span><span class="p">()</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations</span> <span class="o">=</span> <span class="n">num_iterations</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_episodes_per_iteration</span> <span class="o">=</span> <span class="n">num_episodes_per_iteration</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">max_steps_per_episode</span> <span class="o">=</span> <span class="n">max_steps_per_episode</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_epochs_per_iteration</span> <span class="o">=</span> <span class="n">num_epochs_per_iteration</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_iterations_between_eval</span> <span class="o">=</span> <span class="n">num_iterations_between_eval</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">num_episodes_per_eval</span> <span class="o">=</span> <span class="n">num_episodes_per_eval</span>

            <span class="n">train_context</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_context</span><span class="o">=</span><span class="n">train_context</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">default_plots</span><span class="o">=</span><span class="n">default_plots</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">train_context</span>

<span class="k">class</span> <span class="nc">SacAgent</span><span class="p">(</span><span class="n">DqnAgent</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Agent based on the Soft-Actor-Critic algorithm (https://arxiv.org/abs/1812.05905).&quot;&quot;&quot;</span>
</pre></div>


</details>
<h2 id="variables">Variables</h2>
<div class="codehilite"><pre><span></span><span class="n">seed</span>
</pre></div>


<h2 id="functions">Functions</h2>
<h3 id="get_backends">get_backends</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_backends</span><span class="p">(</span>
    <span class="n">agent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">EasyAgent</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">skip_v1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
</pre></div>


<p>returns a list of all registered backends containing an implementation for the EasyAgent type agent.</p>
<p>Args:
    agent: type deriving from EasyAgent for which the backend identifiers are returned.
    skip_v1: if set only backends compatible with tensorflow v2 compatibility mode and eager execution
        are returned.</p>
<p>Returns:
    a list of admissible values for the 'backend' argument of EazyAgents constructors or a list of all
    available backends if agent is None.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nv">def</span> <span class="nv">get_backends</span><span class="ss">(</span><span class="nv">agent</span>: <span class="nv">Optional</span>[<span class="nv">Type</span>[<span class="nv">EasyAgent</span>]] <span class="o">=</span> <span class="nv">None</span>, <span class="nv">skip_v1</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">False</span><span class="ss">)</span>:

    <span class="s2">&quot;&quot;&quot;</span><span class="s">returns a list of all registered backends containing an implementation for the EasyAgent type agent.</span>

    <span class="nv">Args</span>:

        <span class="nv">agent</span>: <span class="nv">type</span> <span class="nv">deriving</span> <span class="nv">from</span> <span class="nv">EasyAgent</span> <span class="k">for</span> <span class="nv">which</span> <span class="nv">the</span> <span class="nv">backend</span> <span class="nv">identifiers</span> <span class="nv">are</span> <span class="nv">returned</span>.

        <span class="nv">skip_v1</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">only</span> <span class="nv">backends</span> <span class="nv">compatible</span> <span class="nv">with</span> <span class="nv">tensorflow</span> <span class="nv">v2</span> <span class="nv">compatibility</span> <span class="nv">mode</span> <span class="nv">and</span> <span class="nv">eager</span> <span class="nv">execution</span>

            <span class="nv">are</span> <span class="nv">returned</span>.

    <span class="nv">Returns</span>:

        <span class="nv">a</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">admissible</span> <span class="nv">values</span> <span class="k">for</span> <span class="nv">the</span> <span class="s1">&#39;</span><span class="s">backend</span><span class="s1">&#39;</span> <span class="nv">argument</span> <span class="nv">of</span> <span class="nv">EazyAgents</span> <span class="nv">constructors</span> <span class="nv">or</span> <span class="nv">a</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">all</span>

        <span class="nv">available</span> <span class="nv">backends</span> <span class="k">if</span> <span class="nv">agent</span> <span class="nv">is</span> <span class="nv">None</span>.

    <span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">backends</span> <span class="o">=</span> [<span class="nv">b</span> <span class="k">for</span> <span class="nv">b</span> <span class="nv">in</span> <span class="nv">_backends</span> <span class="k">if</span> <span class="ss">(</span><span class="nv">not</span> <span class="nv">skip_v1</span><span class="ss">)</span> <span class="nv">or</span> <span class="nv">b</span>.<span class="nv">tensorflow_v2_eager_compatible</span>]

    <span class="nb">result</span> <span class="o">=</span> [<span class="nv">b</span>.<span class="nv">backend_name</span> <span class="k">for</span> <span class="nv">b</span> <span class="nv">in</span> <span class="nv">backends</span>]

    <span class="k">if</span> <span class="nv">agent</span>:

        <span class="nb">result</span> <span class="o">=</span> [<span class="nv">b</span>.<span class="nv">backend_name</span> <span class="k">for</span> <span class="nv">b</span> <span class="nv">in</span> <span class="nv">backends</span> <span class="k">if</span> <span class="nv">agent</span> <span class="nv">in</span> <span class="nv">b</span>.<span class="nv">get_algorithms</span><span class="ss">()</span>]

    <span class="k">return</span> <span class="nb">result</span>
</pre></div>


</details>
<h3 id="load">load</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
    <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Loads an agent from directory.</p>
<p>After a successful load play() may be called directly.
The agent, model, backend, seed and play policy are restored according to the previously saved agent.</p>
<p>Args:
    directory: the directory containing the previously saved policy.
    callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Result:
    a new instance of EasyAgents</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nv">def</span> <span class="nv">load</span><span class="ss">(</span><span class="nv">directory</span>: <span class="nv">str</span>,

         <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

    <span class="s2">&quot;&quot;&quot;</span><span class="s">Loads an agent from directory.</span>

    <span class="nv">After</span> <span class="nv">a</span> <span class="nv">successful</span> <span class="nv">load</span> <span class="nv">play</span><span class="ss">()</span> <span class="nv">may</span> <span class="nv">be</span> <span class="nv">called</span> <span class="nv">directly</span>.

    <span class="nv">The</span> <span class="nv">agent</span>, <span class="nv">model</span>, <span class="nv">backend</span>, <span class="nv">seed</span> <span class="nv">and</span> <span class="nv">play</span> <span class="nv">policy</span> <span class="nv">are</span> <span class="nv">restored</span> <span class="nv">according</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">previously</span> <span class="nv">saved</span> <span class="nv">agent</span>.

    <span class="nv">Args</span>:

        <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">previously</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

    <span class="nb">Result</span>:

        <span class="nv">a</span> <span class="nv">new</span> <span class="nv">instance</span> <span class="nv">of</span> <span class="nv">EasyAgents</span>

    <span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">assert</span> <span class="nv">directory</span>

    <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

    <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

    <span class="nv">assert</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">isdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>, <span class="nv">f</span><span class="s1">&#39;</span><span class="s">directory &quot;{directory}&quot; not found.</span><span class="s1">&#39;</span>

    <span class="nv">assert</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">isfile</span><span class="ss">(</span><span class="nv">agent_json_path</span><span class="ss">)</span>, <span class="s1">&#39;</span><span class="s">file &quot;{agent_json_path}&quot; not found.</span><span class="s1">&#39;</span>

    <span class="nv">assert</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">isdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>, <span class="nv">f</span><span class="s1">&#39;</span><span class="s">directory &quot;{policy_directory}&quot; not found.</span><span class="s1">&#39;</span>

    <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

        <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">json</span>.<span class="nv">load</span><span class="ss">(</span><span class="nv">jsonfile</span><span class="ss">)</span>

    <span class="nb">result</span> <span class="o">=</span> <span class="nv">EasyAgent</span>.<span class="nv">_from_dict</span><span class="ss">(</span><span class="nv">agent_dict</span><span class="ss">)</span>

    <span class="nv">callbacks</span> <span class="o">=</span> <span class="nb">result</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

    <span class="nb">result</span>.<span class="nv">_backend_agent</span>.<span class="nv">load</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

    <span class="k">return</span> <span class="nb">result</span>
</pre></div>


</details>
<h3 id="register_backend">register_backend</h3>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">register_backend</span><span class="p">(</span>
    <span class="n">backend</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">BackendAgentFactory</span>
<span class="p">)</span>
</pre></div>


<p>registers a backend as a factory for agent implementations.</p>
<p>If another backend with the same name is already registered, the old backend is replaced by backend.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nv">def</span> <span class="nv">register_backend</span><span class="ss">(</span><span class="nv">backend</span>: <span class="nv">bcore</span>.<span class="nv">BackendAgentFactory</span><span class="ss">)</span>:

    <span class="s2">&quot;&quot;&quot;</span><span class="s">registers a backend as a factory for agent implementations.</span>

    <span class="k">If</span> <span class="nv">another</span> <span class="nv">backend</span> <span class="nv">with</span> <span class="nv">the</span> <span class="nv">same</span> <span class="nv">name</span> <span class="nv">is</span> <span class="nv">already</span> <span class="nv">registered</span>, <span class="nv">the</span> <span class="nv">old</span> <span class="nv">backend</span> <span class="nv">is</span> <span class="nv">replaced</span> <span class="nv">by</span> <span class="nv">backend</span>.

    <span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">assert</span> <span class="nv">backend</span>

    <span class="nv">old_backends</span> <span class="o">=</span> [<span class="nv">b</span> <span class="k">for</span> <span class="nv">b</span> <span class="nv">in</span> <span class="nv">_backends</span> <span class="k">if</span> <span class="nv">b</span>.<span class="nv">backend_name</span> <span class="o">==</span> <span class="nv">backend</span>.<span class="nv">backend_name</span>]

    <span class="k">for</span> <span class="nv">old_backend</span> <span class="nv">in</span> <span class="nv">old_backends</span>:

        <span class="nv">_backends</span>.<span class="nv">remove</span><span class="ss">(</span><span class="nv">old_backend</span><span class="ss">)</span>

    <span class="nv">_backends</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">backend</span><span class="ss">)</span>
</pre></div>


</details>
<h2 id="classes">Classes</h2>
<h3 id="cemagent">CemAgent</h3>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">CemAgent</span><span class="p">(</span>
    <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>creates a new agent based on the cross-entropy-method algorithm.</p>
<p>From https://learning.mpi-sws.org/mlss2016/slides/2016-MLSS-RL.pdf:
 Initialize µ ∈Rd,σ ∈Rd
 for iteration = 1,2,... num_iterations do
     Collect num_episodes_per_iteration samples of θi ∼ N(µ,diag(σ))
     Perform a noisy evaluation Ri ∼ θi
     Select the top elite_set_fraction of samples (e.g. p = 0.2), which we’ll call the elite set
     Fit a Gaussian distribution, with diagonal covariance, to the elite set, obtaining a new µ,σ.
 end for
 Return the ﬁnal µ.</p>
<p>see https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.81.6579&amp;rep=rep1&amp;type=pdf</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nv">class</span> <span class="nv">CemAgent</span><span class="ss">(</span><span class="nv">EasyAgent</span><span class="ss">)</span>:

    <span class="s2">&quot;&quot;&quot;</span><span class="s">creates a new agent based on the cross-entropy-method algorithm.</span>

       <span class="nv">From</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">learning</span>.<span class="nv">mpi</span><span class="o">-</span><span class="nv">sws</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">mlss2016</span><span class="o">/</span><span class="nv">slides</span><span class="o">/</span><span class="mi">2016</span><span class="o">-</span><span class="nv">MLSS</span><span class="o">-</span><span class="nv">RL</span>.<span class="nv">pdf</span>:

        <span class="nv">Initialize</span> µ ∈<span class="nv">Rd</span>,σ ∈<span class="nv">Rd</span>

        <span class="k">for</span> <span class="nv">iteration</span> <span class="o">=</span> <span class="mi">1</span>,<span class="mi">2</span>,... <span class="nv">num_iterations</span> <span class="k">do</span>

            <span class="nv">Collect</span> <span class="nv">num_episodes_per_iteration</span> <span class="nv">samples</span> <span class="nv">of</span> θ<span class="nv">i</span> ∼ <span class="nv">N</span><span class="ss">(</span>µ,<span class="nv">diag</span><span class="ss">(</span>σ<span class="ss">))</span>

            <span class="nv">Perform</span> <span class="nv">a</span> <span class="nv">noisy</span> <span class="nv">evaluation</span> <span class="nv">Ri</span> ∼ θ<span class="nv">i</span>

            <span class="nv">Select</span> <span class="nv">the</span> <span class="nv">top</span> <span class="nv">elite_set_fraction</span> <span class="nv">of</span> <span class="nv">samples</span> <span class="ss">(</span><span class="nv">e</span>.<span class="nv">g</span>. <span class="nv">p</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">2</span><span class="ss">)</span>, <span class="nv">which</span> <span class="nv">we</span>’<span class="nv">ll</span> <span class="k">call</span> <span class="nl">the</span> <span class="nv">elite</span> <span class="nv">set</span>

            <span class="nv">Fit</span> <span class="nv">a</span> <span class="nv">Gaussian</span> <span class="nv">distribution</span>, <span class="nv">with</span> <span class="nv">diagonal</span> <span class="nv">covariance</span>, <span class="nv">to</span> <span class="nv">the</span> <span class="nv">elite</span> <span class="nv">set</span>, <span class="nv">obtaining</span> <span class="nv">a</span> <span class="nv">new</span> µ,σ.

        <span class="k">end</span> <span class="k">for</span>

        <span class="k">Return</span> <span class="nv">the</span> ﬁ<span class="nv">nal</span> µ.

        <span class="nv">see</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">citeseerx</span>.<span class="nv">ist</span>.<span class="nv">psu</span>.<span class="nv">edu</span><span class="o">/</span><span class="nv">viewdoc</span><span class="o">/</span><span class="nv">download</span>?<span class="nv">doi</span><span class="o">=</span><span class="mi">10</span>.<span class="mi">1</span>.<span class="mi">1</span>.<span class="mi">81</span>.<span class="mi">6579</span><span class="o">&amp;</span><span class="nv">rep</span><span class="o">=</span><span class="nv">rep1</span><span class="o">&amp;</span><span class="nv">type</span><span class="o">=</span><span class="nv">pdf</span>

    <span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">def</span> <span class="nv">__init__</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">gym_env_name</span>: <span class="nv">str</span>,

                 <span class="nv">fc_layers</span>: <span class="nv">Optional</span>[<span class="nv">Tuple</span>[<span class="nv">int</span>, ...]] <span class="o">=</span> <span class="nv">None</span>,

                 <span class="nv">backend</span>: <span class="nv">str</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="nv">assert</span> <span class="nv">False</span>, <span class="s2">&quot;</span><span class="s">CemAgent is currently not available (pending migration of keras-rl to tf2.0)</span><span class="s2">&quot;</span>

    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">100</span>,

              <span class="nv">num_episodes_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">elite_set_fraction</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">1</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">5</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">CemTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">num_episodes_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">in</span> <span class="nv">each</span> <span class="nv">iteration</span>. <span class="k">for</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">a</span> <span class="nv">new</span>

                <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">sampled</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">weight</span> <span class="nv">distribution</span>.

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">elite_set_fraction</span>: <span class="nv">the</span> <span class="nv">fraction</span> <span class="nv">of</span> <span class="nv">policies</span> <span class="nv">which</span> <span class="nv">are</span> <span class="nv">members</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">elite</span> <span class="nv">set</span>.

                <span class="nv">These</span> <span class="nv">policies</span> <span class="nv">are</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">fit</span> <span class="nv">a</span> <span class="nv">new</span> <span class="nv">weight</span> <span class="nv">distribution</span> <span class="nv">in</span> <span class="nv">each</span> <span class="nv">iteration</span>.

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">CemTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">elite_set_fraction</span> <span class="o">=</span> <span class="nv">elite_set_fraction</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro">Ancestors (in MRO)</h4>
<ul>
<li>easyagents.agents.EasyAgent</li>
<li>abc.ABC</li>
</ul>
<h4 id="methods">Methods</h4>
<h5 id="evaluate">evaluate</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy and computes metrics on rewards.</p>
<p>Args:
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode</p>
<p>Returns:
    extensible score metrics</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>
</pre></div>


</details>
<h5 id="play">play</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">play_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy.</p>
<p>Args:
    callbacks: list of callbacks called during each episode play
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode
    play_context: play configuration to be used. If set override all other play context arguments
    default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</p>
<p>Returns:
    play_context containg the actions taken and the rewards received during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>
</pre></div>


</details>
<h5 id="save">save</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</pre></div>


<p>Saves the currently trained actor policy in directory.</p>
<p>If save is called before a trained policy is created, eg by calling train, an exception is raised.</p>
<p>Args:
     directory: the directory to save the policy weights to.
        if the directory does not exist yet, a new directory is created. if None the policy is saved
        in a temp directory.
     callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Returns:
    the absolute path to the directory containing the saved policy.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>
</pre></div>


</details>
<h5 id="train">train</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">num_episodes_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">elite_set_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">train_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">CemTrainContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Trains a new model using the gym environment passed during instantiation.</p>
<p>Args:
    callbacks: list of callbacks called during training and evaluation
    num_iterations: number of times the training is repeated (with additional data)
    num_episodes_per_iteration: number of episodes played in each iteration. for each episode a new
        policy is sampled from the current weight distribution.
    max_steps_per_episode: maximum number of steps per episode
    elite_set_fraction: the fraction of policies which are members of the elite set.
        These policies are used to fit a new weight distribution in each iteration.
    num_iterations_between_eval: number of training iterations before the current policy is evaluated.
        if 0 no evaluation is performed.
    num_episodes_per_eval: number of episodes played to estimate the average return and steps
    train_context: training configuration to be used. if set overrides all other training context arguments.
    default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).
        if None default callbacks are only added if the callbacks list is empty</p>
<p>Returns:
    train_context: the training configuration containing the loss and sum of rewards encountered
        during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">100</span>,

              <span class="nv">num_episodes_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">elite_set_fraction</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">1</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">5</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">CemTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">num_episodes_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">in</span> <span class="nv">each</span> <span class="nv">iteration</span>. <span class="k">for</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">a</span> <span class="nv">new</span>

                <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">sampled</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">weight</span> <span class="nv">distribution</span>.

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">elite_set_fraction</span>: <span class="nv">the</span> <span class="nv">fraction</span> <span class="nv">of</span> <span class="nv">policies</span> <span class="nv">which</span> <span class="nv">are</span> <span class="nv">members</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">elite</span> <span class="nv">set</span>.

                <span class="nv">These</span> <span class="nv">policies</span> <span class="nv">are</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">fit</span> <span class="nv">a</span> <span class="nv">new</span> <span class="nv">weight</span> <span class="nv">distribution</span> <span class="nv">in</span> <span class="nv">each</span> <span class="nv">iteration</span>.

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">CemTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">elite_set_fraction</span> <span class="o">=</span> <span class="nv">elite_set_fraction</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<h3 id="doubledqnagent">DoubleDqnAgent</h3>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DoubleDqnAgent</span><span class="p">(</span>
    <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Agent based on the Double Dqn algorithm (https://arxiv.org/abs/1509.06461)</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="n">DoubleDqnAgent</span>(<span class="n">DqnAgent</span>):

    <span class="s">&quot;&quot;&quot;Agent based on the Double Dqn algorithm (https://arxiv.org/abs/1509.06461)&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">__init__</span>(<span class="k">self</span>,

                 <span class="n">gym_env_name:</span> <span class="n">str</span>,

                 <span class="n">fc_layers:</span> <span class="n">Optional</span>[<span class="n">Tuple</span>[<span class="nb">int</span>, ...]] = <span class="n">None</span>,

                 <span class="n">backend:</span> <span class="n">str</span> = <span class="n">None</span>):

        <span class="n">assert</span> <span class="nb">False</span>, <span class="s">&quot;DoubleDqnAgent is currently not available (pending migration of tensorforce/keras-rl to tf2.0)&quot;</span>
</pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_1">Ancestors (in MRO)</h4>
<ul>
<li>easyagents.agents.DqnAgent</li>
<li>easyagents.agents.EasyAgent</li>
<li>abc.ABC</li>
</ul>
<h4 id="methods_1">Methods</h4>
<h5 id="evaluate_1">evaluate</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy and computes metrics on rewards.</p>
<p>Args:
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode</p>
<p>Returns:
    extensible score metrics</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>
</pre></div>


</details>
<h5 id="play_1">play</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">play_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy.</p>
<p>Args:
    callbacks: list of callbacks called during each episode play
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode
    play_context: play configuration to be used. If set override all other play context arguments
    default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</p>
<p>Returns:
    play_context containg the actions taken and the rewards received during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>
</pre></div>


</details>
<h5 id="save_1">save</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</pre></div>


<p>Saves the currently trained actor policy in directory.</p>
<p>If save is called before a trained policy is created, eg by calling train, an exception is raised.</p>
<p>Args:
     directory: the directory to save the policy weights to.
        if the directory does not exist yet, a new directory is created. if None the policy is saved
        in a temp directory.
     callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Returns:
    the absolute path to the directory containing the saved policy.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>
</pre></div>


</details>
<h5 id="train_1">train</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">num_steps_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">train_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StepsTrainContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Trains a new model using the gym environment passed during instantiation.</p>
<p>Args:
    callbacks: list of callbacks called during training and evaluation
    num_iterations: number of times the training is repeated (with additional data)
    max_steps_per_episode: maximum number of steps per episode
    num_steps_per_iteration: number of steps played per training iteration
    num_steps_buffer_preload: number of initial collect steps to preload the buffer
    num_steps_sampled_from_buffer: the number of steps sampled from buffer for each iteration training
    num_iterations_between_eval: number of training iterations before the current policy is evaluated.
        if 0 no evaluation is performed.
    num_episodes_per_eval: number of episodes played to estimate the average return and steps
    learning_rate: the learning rate used in the next iteration's policy training (0,1]
    train_context: training configuration to be used. if set overrides all other training context arguments.
    default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).
        if None default callbacks are only added if the callbacks list is empty</p>
<p>Returns:
    train_context: the training configuration containing the loss and sum of rewards encountered
        during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">20000</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">num_steps_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

              <span class="nv">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span>,

              <span class="nv">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">learning_rate</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">001</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">StepsTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_steps_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">played</span> <span class="nv">per</span> <span class="nv">training</span> <span class="nv">iteration</span>

            <span class="nv">num_steps_buffer_preload</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">initial</span> <span class="nv">collect</span> <span class="nv">steps</span> <span class="nv">to</span> <span class="nv">preload</span> <span class="nv">the</span> <span class="nv">buffer</span>

            <span class="nv">num_steps_sampled_from_buffer</span>: <span class="nv">the</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">sampled</span> <span class="nv">from</span> <span class="nv">buffer</span> <span class="k">for</span> <span class="nv">each</span> <span class="nv">iteration</span> <span class="nv">training</span>

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">learning_rate</span>: <span class="nv">the</span> <span class="nv">learning</span> <span class="nv">rate</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">iteration</span><span class="s1">&#39;</span><span class="s">s policy training (0,1]</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">StepsTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_per_iteration</span> <span class="o">=</span> <span class="nv">num_steps_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_buffer_preload</span> <span class="o">=</span> <span class="nv">num_steps_buffer_preload</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_sampled_from_buffer</span> <span class="o">=</span> <span class="nv">num_steps_sampled_from_buffer</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="nv">learning_rate</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<h3 id="dqnagent">DqnAgent</h3>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DqnAgent</span><span class="p">(</span>
    <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>creates a new agent based on the Dqn algorithm.</p>
<p>From wikipedia:
The DeepMind system used a deep convolutional neural network, with layers of tiled convolutional filters to mimic
the effects of receptive fields. Reinforcement learning is unstable or divergent when a nonlinear function
approximator such as a neural network is used to represent Q.
This instability comes from the correlations present in the sequence of observations, the fact that small updates
to Q may significantly change the policy and the data distribution, and the correlations between Q and the
target values.</p>
<p>The technique used experience replay, a biologically inspired mechanism that uses a random sample of prior actions
instead of the most recent action to proceed.[2] This removes correlations in the observation sequence and smooths
changes in the data distribution. Iterative update adjusts Q towards target values that are only periodically
updated, further reducing correlations with the target.[17]</p>
<p>see also: https://deepmind.com/research/publications/human-level-control-through-deep-reinforcement-learning</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nv">class</span> <span class="nv">DqnAgent</span><span class="ss">(</span><span class="nv">EasyAgent</span><span class="ss">)</span>:

    <span class="s2">&quot;&quot;&quot;</span><span class="s">creates a new agent based on the Dqn algorithm.</span>

    <span class="nv">From</span> <span class="nv">wikipedia</span>:

    <span class="nv">The</span> <span class="nv">DeepMind</span> <span class="nv">system</span> <span class="nv">used</span> <span class="nv">a</span> <span class="nv">deep</span> <span class="nv">convolutional</span> <span class="nv">neural</span> <span class="nv">network</span>, <span class="nv">with</span> <span class="nv">layers</span> <span class="nv">of</span> <span class="nv">tiled</span> <span class="nv">convolutional</span> <span class="nv">filters</span> <span class="nv">to</span> <span class="nv">mimic</span>

    <span class="nv">the</span> <span class="nv">effects</span> <span class="nv">of</span> <span class="nv">receptive</span> <span class="nv">fields</span>. <span class="nv">Reinforcement</span> <span class="nv">learning</span> <span class="nv">is</span> <span class="nv">unstable</span> <span class="nv">or</span> <span class="nv">divergent</span> <span class="nv">when</span> <span class="nv">a</span> <span class="nv">nonlinear</span> <span class="nv">function</span>

    <span class="nv">approximator</span> <span class="nv">such</span> <span class="nv">as</span> <span class="nv">a</span> <span class="nv">neural</span> <span class="nv">network</span> <span class="nv">is</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">represent</span> <span class="nv">Q</span>.

    <span class="nv">This</span> <span class="nv">instability</span> <span class="nv">comes</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">correlations</span> <span class="nv">present</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">sequence</span> <span class="nv">of</span> <span class="nv">observations</span>, <span class="nv">the</span> <span class="nv">fact</span> <span class="nv">that</span> <span class="nv">small</span> <span class="nv">updates</span>

    <span class="nv">to</span> <span class="nv">Q</span> <span class="nv">may</span> <span class="nv">significantly</span> <span class="nv">change</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">data</span> <span class="nv">distribution</span>, <span class="nv">and</span> <span class="nv">the</span> <span class="nv">correlations</span> <span class="nv">between</span> <span class="nv">Q</span> <span class="nv">and</span> <span class="nv">the</span>

    <span class="nv">target</span> <span class="nv">values</span>.

    <span class="nv">The</span> <span class="nv">technique</span> <span class="nv">used</span> <span class="nv">experience</span> <span class="nv">replay</span>, <span class="nv">a</span> <span class="nv">biologically</span> <span class="nv">inspired</span> <span class="nv">mechanism</span> <span class="nv">that</span> <span class="nv">uses</span> <span class="nv">a</span> <span class="k">random</span> <span class="nv">sample</span> <span class="nv">of</span> <span class="nv">prior</span> <span class="nv">actions</span>

    <span class="nv">instead</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">most</span> <span class="nv">recent</span> <span class="nv">action</span> <span class="nv">to</span> <span class="nv">proceed</span>.[<span class="mi">2</span>] <span class="nv">This</span> <span class="nv">removes</span> <span class="nv">correlations</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">observation</span> <span class="nv">sequence</span> <span class="nv">and</span> <span class="nv">smooths</span>

    <span class="nv">changes</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">data</span> <span class="nv">distribution</span>. <span class="nv">Iterative</span> <span class="nv">update</span> <span class="nv">adjusts</span> <span class="nv">Q</span> <span class="nv">towards</span> <span class="nv">target</span> <span class="nv">values</span> <span class="nv">that</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">periodically</span>

    <span class="nv">updated</span>, <span class="nv">further</span> <span class="nv">reducing</span> <span class="nv">correlations</span> <span class="nv">with</span> <span class="nv">the</span> <span class="nv">target</span>.[<span class="mi">17</span>]

    <span class="nv">see</span> <span class="nv">also</span>: <span class="nv">https</span>:<span class="o">//</span><span class="nv">deepmind</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">research</span><span class="o">/</span><span class="nv">publications</span><span class="o">/</span><span class="nv">human</span><span class="o">-</span><span class="nv">level</span><span class="o">-</span><span class="nv">control</span><span class="o">-</span><span class="nv">through</span><span class="o">-</span><span class="nv">deep</span><span class="o">-</span><span class="nv">reinforcement</span><span class="o">-</span><span class="nv">learning</span>

    <span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">20000</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">num_steps_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

              <span class="nv">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span>,

              <span class="nv">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">learning_rate</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">001</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">StepsTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_steps_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">played</span> <span class="nv">per</span> <span class="nv">training</span> <span class="nv">iteration</span>

            <span class="nv">num_steps_buffer_preload</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">initial</span> <span class="nv">collect</span> <span class="nv">steps</span> <span class="nv">to</span> <span class="nv">preload</span> <span class="nv">the</span> <span class="nv">buffer</span>

            <span class="nv">num_steps_sampled_from_buffer</span>: <span class="nv">the</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">sampled</span> <span class="nv">from</span> <span class="nv">buffer</span> <span class="k">for</span> <span class="nv">each</span> <span class="nv">iteration</span> <span class="nv">training</span>

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">learning_rate</span>: <span class="nv">the</span> <span class="nv">learning</span> <span class="nv">rate</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">iteration</span><span class="s1">&#39;</span><span class="s">s policy training (0,1]</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">StepsTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_per_iteration</span> <span class="o">=</span> <span class="nv">num_steps_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_buffer_preload</span> <span class="o">=</span> <span class="nv">num_steps_buffer_preload</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_sampled_from_buffer</span> <span class="o">=</span> <span class="nv">num_steps_sampled_from_buffer</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="nv">learning_rate</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_2">Ancestors (in MRO)</h4>
<ul>
<li>easyagents.agents.EasyAgent</li>
<li>abc.ABC</li>
</ul>
<h4 id="descendants">Descendants</h4>
<ul>
<li>easyagents.agents.DoubleDqnAgent</li>
<li>easyagents.agents.DuelingDqnAgent</li>
<li>easyagents.agents.SacAgent</li>
</ul>
<h4 id="methods_2">Methods</h4>
<h5 id="evaluate_2">evaluate</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy and computes metrics on rewards.</p>
<p>Args:
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode</p>
<p>Returns:
    extensible score metrics</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>
</pre></div>


</details>
<h5 id="play_2">play</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">play_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy.</p>
<p>Args:
    callbacks: list of callbacks called during each episode play
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode
    play_context: play configuration to be used. If set override all other play context arguments
    default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</p>
<p>Returns:
    play_context containg the actions taken and the rewards received during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>
</pre></div>


</details>
<h5 id="save_2">save</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</pre></div>


<p>Saves the currently trained actor policy in directory.</p>
<p>If save is called before a trained policy is created, eg by calling train, an exception is raised.</p>
<p>Args:
     directory: the directory to save the policy weights to.
        if the directory does not exist yet, a new directory is created. if None the policy is saved
        in a temp directory.
     callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Returns:
    the absolute path to the directory containing the saved policy.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>
</pre></div>


</details>
<h5 id="train_2">train</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">num_steps_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">train_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StepsTrainContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Trains a new model using the gym environment passed during instantiation.</p>
<p>Args:
    callbacks: list of callbacks called during training and evaluation
    num_iterations: number of times the training is repeated (with additional data)
    max_steps_per_episode: maximum number of steps per episode
    num_steps_per_iteration: number of steps played per training iteration
    num_steps_buffer_preload: number of initial collect steps to preload the buffer
    num_steps_sampled_from_buffer: the number of steps sampled from buffer for each iteration training
    num_iterations_between_eval: number of training iterations before the current policy is evaluated.
        if 0 no evaluation is performed.
    num_episodes_per_eval: number of episodes played to estimate the average return and steps
    learning_rate: the learning rate used in the next iteration's policy training (0,1]
    train_context: training configuration to be used. if set overrides all other training context arguments.
    default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).
        if None default callbacks are only added if the callbacks list is empty</p>
<p>Returns:
    train_context: the training configuration containing the loss and sum of rewards encountered
        during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">20000</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">num_steps_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

              <span class="nv">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span>,

              <span class="nv">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">learning_rate</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">001</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">StepsTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_steps_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">played</span> <span class="nv">per</span> <span class="nv">training</span> <span class="nv">iteration</span>

            <span class="nv">num_steps_buffer_preload</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">initial</span> <span class="nv">collect</span> <span class="nv">steps</span> <span class="nv">to</span> <span class="nv">preload</span> <span class="nv">the</span> <span class="nv">buffer</span>

            <span class="nv">num_steps_sampled_from_buffer</span>: <span class="nv">the</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">sampled</span> <span class="nv">from</span> <span class="nv">buffer</span> <span class="k">for</span> <span class="nv">each</span> <span class="nv">iteration</span> <span class="nv">training</span>

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">learning_rate</span>: <span class="nv">the</span> <span class="nv">learning</span> <span class="nv">rate</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">iteration</span><span class="s1">&#39;</span><span class="s">s policy training (0,1]</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">StepsTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_per_iteration</span> <span class="o">=</span> <span class="nv">num_steps_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_buffer_preload</span> <span class="o">=</span> <span class="nv">num_steps_buffer_preload</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_sampled_from_buffer</span> <span class="o">=</span> <span class="nv">num_steps_sampled_from_buffer</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="nv">learning_rate</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<h3 id="duelingdqnagent">DuelingDqnAgent</h3>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">DuelingDqnAgent</span><span class="p">(</span>
    <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Agent based on the Dueling Dqn algorithm (https://arxiv.org/abs/1511.06581).</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="n">DuelingDqnAgent</span>(<span class="n">DqnAgent</span>):

    <span class="s">&quot;&quot;&quot;Agent based on the Dueling Dqn algorithm (https://arxiv.org/abs/1511.06581).&quot;&quot;&quot;</span>
</pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_3">Ancestors (in MRO)</h4>
<ul>
<li>easyagents.agents.DqnAgent</li>
<li>easyagents.agents.EasyAgent</li>
<li>abc.ABC</li>
</ul>
<h4 id="methods_3">Methods</h4>
<h5 id="evaluate_3">evaluate</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy and computes metrics on rewards.</p>
<p>Args:
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode</p>
<p>Returns:
    extensible score metrics</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>
</pre></div>


</details>
<h5 id="play_3">play</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">play_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy.</p>
<p>Args:
    callbacks: list of callbacks called during each episode play
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode
    play_context: play configuration to be used. If set override all other play context arguments
    default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</p>
<p>Returns:
    play_context containg the actions taken and the rewards received during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>
</pre></div>


</details>
<h5 id="save_3">save</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</pre></div>


<p>Saves the currently trained actor policy in directory.</p>
<p>If save is called before a trained policy is created, eg by calling train, an exception is raised.</p>
<p>Args:
     directory: the directory to save the policy weights to.
        if the directory does not exist yet, a new directory is created. if None the policy is saved
        in a temp directory.
     callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Returns:
    the absolute path to the directory containing the saved policy.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>
</pre></div>


</details>
<h5 id="train_3">train</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">num_steps_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">train_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StepsTrainContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Trains a new model using the gym environment passed during instantiation.</p>
<p>Args:
    callbacks: list of callbacks called during training and evaluation
    num_iterations: number of times the training is repeated (with additional data)
    max_steps_per_episode: maximum number of steps per episode
    num_steps_per_iteration: number of steps played per training iteration
    num_steps_buffer_preload: number of initial collect steps to preload the buffer
    num_steps_sampled_from_buffer: the number of steps sampled from buffer for each iteration training
    num_iterations_between_eval: number of training iterations before the current policy is evaluated.
        if 0 no evaluation is performed.
    num_episodes_per_eval: number of episodes played to estimate the average return and steps
    learning_rate: the learning rate used in the next iteration's policy training (0,1]
    train_context: training configuration to be used. if set overrides all other training context arguments.
    default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).
        if None default callbacks are only added if the callbacks list is empty</p>
<p>Returns:
    train_context: the training configuration containing the loss and sum of rewards encountered
        during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">20000</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">num_steps_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

              <span class="nv">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span>,

              <span class="nv">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">learning_rate</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">001</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">StepsTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_steps_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">played</span> <span class="nv">per</span> <span class="nv">training</span> <span class="nv">iteration</span>

            <span class="nv">num_steps_buffer_preload</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">initial</span> <span class="nv">collect</span> <span class="nv">steps</span> <span class="nv">to</span> <span class="nv">preload</span> <span class="nv">the</span> <span class="nv">buffer</span>

            <span class="nv">num_steps_sampled_from_buffer</span>: <span class="nv">the</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">sampled</span> <span class="nv">from</span> <span class="nv">buffer</span> <span class="k">for</span> <span class="nv">each</span> <span class="nv">iteration</span> <span class="nv">training</span>

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">learning_rate</span>: <span class="nv">the</span> <span class="nv">learning</span> <span class="nv">rate</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">iteration</span><span class="s1">&#39;</span><span class="s">s policy training (0,1]</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">StepsTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_per_iteration</span> <span class="o">=</span> <span class="nv">num_steps_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_buffer_preload</span> <span class="o">=</span> <span class="nv">num_steps_buffer_preload</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_sampled_from_buffer</span> <span class="o">=</span> <span class="nv">num_steps_sampled_from_buffer</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="nv">learning_rate</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<h3 id="easyagent">EasyAgent</h3>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">EasyAgent</span><span class="p">(</span>
    <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Abstract base class for all easy reinforcment learning agents.</p>
<p>Besides forwarding train and play it implements persistence.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nv">class</span> <span class="nv">EasyAgent</span><span class="ss">(</span><span class="nv">ABC</span><span class="ss">)</span>:

    <span class="s2">&quot;&quot;&quot;</span><span class="s">Abstract base class for all easy reinforcment learning agents.</span>

    <span class="nv">Besides</span> <span class="nv">forwarding</span> <span class="nv">train</span> <span class="nv">and</span> <span class="nv">play</span> <span class="nv">it</span> <span class="nv">implements</span> <span class="nv">persistence</span>.<span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">_KEY_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">backend</span><span class="s1">&#39;</span>

    <span class="nv">_KEY_EASYAGENT_CLASS</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">easyagent_class</span><span class="s1">&#39;</span>

    <span class="nv">_KEY_EASYAGENT_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">easyagent.json</span><span class="s1">&#39;</span>

    <span class="nv">_KEY_MODEL_CONFIG</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">model_config</span><span class="s1">&#39;</span>

    <span class="nv">_KEY_POLICY_DIRECTORY</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">policy</span><span class="s1">&#39;</span>

    <span class="nv">_KEY_VERSION</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">version</span><span class="s1">&#39;</span>

    <span class="nv">def</span> <span class="nv">__init__</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">gym_env_name</span>: <span class="nv">str</span>,

                 <span class="nv">fc_layers</span>: <span class="nv">Union</span>[<span class="nv">Tuple</span>[<span class="nv">int</span>, ...], <span class="nv">int</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

                 <span class="nv">backend</span>: <span class="nv">str</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span>

            <span class="nv">Args</span>:

                <span class="nv">gym_env_name</span>: <span class="nv">name</span> <span class="nv">of</span> <span class="nv">an</span> <span class="nv">OpenAI</span> <span class="nv">gym</span> <span class="nv">environment</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span> <span class="k">for</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

                <span class="nv">fc_layers</span>: <span class="nv">defines</span> <span class="nv">the</span> <span class="nv">neural</span> <span class="nv">network</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>, <span class="nv">a</span> <span class="nv">sequence</span> <span class="nv">of</span> <span class="nv">fully</span> <span class="nv">connected</span>

                    <span class="nv">layers</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">given</span> <span class="nv">size</span>. <span class="nv">Eg</span> <span class="ss">(</span><span class="mi">75</span>,<span class="mi">40</span><span class="ss">)</span> <span class="nv">yields</span> <span class="nv">a</span> <span class="nv">neural</span> <span class="nv">network</span> <span class="nv">consisting</span>

                    <span class="nv">out</span> <span class="nv">of</span> <span class="mi">2</span> <span class="nv">hidden</span> <span class="nv">layers</span>, <span class="nv">the</span> <span class="nv">first</span> <span class="nv">one</span> <span class="nv">containing</span> <span class="mi">75</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">second</span> <span class="nv">layer</span>

                    <span class="nv">containing</span> <span class="mi">40</span> <span class="nv">neurons</span>.

                <span class="nv">backend</span><span class="o">=</span><span class="nv">the</span> <span class="nv">backend</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span> <span class="ss">(</span><span class="nv">eg</span> <span class="s1">&#39;</span><span class="s">tfagents</span><span class="s1">&#39;</span><span class="ss">)</span>, <span class="k">if</span> <span class="nv">None</span> <span class="nv">a</span> <span class="nv">default</span> <span class="nv">implementation</span> <span class="nv">is</span> <span class="nv">used</span>.

                    <span class="k">call</span> <span class="nl">get_backends</span><span class="ss">()</span> <span class="nv">to</span> <span class="nv">get</span> <span class="nv">a</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">available</span> <span class="nv">backends</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">model_config</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">ModelConfig</span><span class="ss">(</span><span class="nv">gym_env_name</span><span class="o">=</span><span class="nv">gym_env_name</span>, <span class="nv">fc_layers</span><span class="o">=</span><span class="nv">fc_layers</span>, <span class="nv">seed</span><span class="o">=</span><span class="nv">seed</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_initialize</span><span class="ss">(</span><span class="nv">model_config</span><span class="o">=</span><span class="nv">model_config</span>, <span class="nv">backend_name</span><span class="o">=</span><span class="nv">backend</span><span class="ss">)</span>

        <span class="k">return</span>

    <span class="nv">def</span> <span class="nv">_initialize</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">model_config</span>: <span class="nv">core</span>.<span class="nv">ModelConfig</span>, <span class="nv">backend_name</span>: <span class="nv">str</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="k">if</span> <span class="nv">backend_name</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">backend_name</span> <span class="o">=</span> <span class="nv">easyagents</span>.<span class="nv">backends</span>.<span class="nv">default</span>.<span class="nv">BackendAgentFactory</span>.<span class="nv">backend_name</span>

        <span class="nv">backend</span>: <span class="nv">bcore</span>.<span class="nv">BackendAgentFactory</span> <span class="o">=</span> <span class="nv">_get_backend</span><span class="ss">(</span><span class="nv">backend_name</span><span class="ss">)</span>

        <span class="nv">assert</span> <span class="nv">model_config</span> <span class="nv">is</span> <span class="nv">not</span> <span class="nv">None</span>, <span class="s2">&quot;</span><span class="s">model_config not set.</span><span class="s2">&quot;</span>

        <span class="nv">assert</span> <span class="nv">backend</span>, <span class="nv">f</span><span class="s1">&#39;</span><span class="s">Backend &quot;{backend_name}&quot; not found. The registered backends are {get_backends()}.</span><span class="s1">&#39;</span>

        <span class="nv">self</span>.<span class="nv">_model_config</span>: <span class="nv">core</span>.<span class="nv">ModelConfig</span> <span class="o">=</span> <span class="nv">model_config</span>

        <span class="nv">backend_agent</span> <span class="o">=</span> <span class="nv">backend</span>.<span class="nv">create_agent</span><span class="ss">(</span><span class="nv">easyagent_type</span><span class="o">=</span><span class="nv">type</span><span class="ss">(</span><span class="nv">self</span><span class="ss">)</span>, <span class="nv">model_config</span><span class="o">=</span><span class="nv">model_config</span><span class="ss">)</span>

        <span class="nv">assert</span> <span class="nv">backend_agent</span>, <span class="nv">f</span><span class="s1">&#39;</span><span class="s">Backend &quot;{backend_name}&quot; does not implement &quot;{type(self).__name__}&quot;. </span><span class="s1">&#39;</span> <span class="o">+</span> \

                              <span class="nv">f</span><span class="s1">&#39;</span><span class="s">Choose one of the following backend {get_backends(type(self))}.</span><span class="s1">&#39;</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>: <span class="nv">Optional</span>[<span class="nv">bcore</span>.<span class="nv">_BackendAgent</span>] <span class="o">=</span> <span class="nv">backend_agent</span>

        <span class="nv">self</span>.<span class="nv">_backend_name</span>: <span class="nv">str</span> <span class="o">=</span> <span class="nv">backend_name</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_agent_saver</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">save</span>

        <span class="k">return</span>

    <span class="nv">def</span> <span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">callbacks</span>: <span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>],

                            <span class="nv">default_plots</span>: <span class="nv">Optional</span>[<span class="nv">bool</span>],

                            <span class="nv">default_plot_callbacks</span>: <span class="nv">List</span>[<span class="nv">plot</span>.<span class="nv">_PlotCallback</span>]

                            <span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>]:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Adds the default callbacks and sorts all callbacks in the order</span>

            <span class="nv">_PreProcessCallbacks</span>, <span class="nv">AgentCallbacks</span>, <span class="nv">_PostProcessCallbacks</span>.

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">existing</span> <span class="nv">callbacks</span> <span class="nv">to</span> <span class="nv">prepare</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">or</span> <span class="k">if</span> <span class="nv">None</span> <span class="nv">and</span> <span class="nv">callbacks</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">contain</span> <span class="nv">plots</span> <span class="k">then</span> <span class="nv">the</span> <span class="nv">default</span> <span class="nv">plots</span> <span class="nv">are</span> <span class="nv">added</span>

            <span class="nv">default_plot_callbacks</span>: <span class="nv">plot</span> <span class="nv">callbacks</span> <span class="nv">to</span> <span class="nv">add</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">pre_process</span>: <span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>] <span class="o">=</span> [<span class="nv">plot</span>.<span class="nv">_PreProcess</span><span class="ss">()</span>]

        <span class="nv">agent</span>: <span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>] <span class="o">=</span> []

        <span class="nv">post_process</span>: <span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>] <span class="o">=</span> [<span class="nv">plot</span>.<span class="nv">_PostProcess</span><span class="ss">()</span>]

        <span class="k">if</span> <span class="nv">default_plots</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">default_plots</span> <span class="o">=</span> <span class="nv">True</span>

            <span class="k">for</span> <span class="nv">c</span> <span class="nv">in</span> <span class="nv">callbacks</span>:

                <span class="nv">default_plots</span> <span class="o">=</span> <span class="nv">default_plots</span> <span class="nv">and</span> <span class="ss">(</span><span class="nv">not</span> <span class="nv">isinstance</span><span class="ss">(</span><span class="nv">c</span>, <span class="nv">plot</span>.<span class="nv">_PlotCallback</span><span class="ss">))</span>

        <span class="k">if</span> <span class="nv">default_plots</span>:

            <span class="nv">agent</span> <span class="o">=</span> <span class="nv">default_plot_callbacks</span>

        <span class="k">for</span> <span class="nv">c</span> <span class="nv">in</span> <span class="nv">callbacks</span>:

            <span class="k">if</span> <span class="nv">isinstance</span><span class="ss">(</span><span class="nv">c</span>, <span class="nv">core</span>.<span class="nv">_PreProcessCallback</span><span class="ss">)</span>:

                <span class="nv">pre_process</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">c</span><span class="ss">)</span>

            <span class="k">else</span>:

                <span class="k">if</span> <span class="nv">isinstance</span><span class="ss">(</span><span class="nv">c</span>, <span class="nv">core</span>.<span class="nv">_PostProcessCallback</span><span class="ss">)</span>:

                    <span class="nv">post_process</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">c</span><span class="ss">)</span>

                <span class="k">else</span>:

                    <span class="nv">agent</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">c</span><span class="ss">)</span>

        <span class="nb">result</span>: <span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>] <span class="o">=</span> <span class="nv">pre_process</span> <span class="o">+</span> <span class="nv">agent</span> <span class="o">+</span> <span class="nv">post_process</span>

        <span class="k">return</span> <span class="nb">result</span>

    @<span class="nv">staticmethod</span>

    <span class="nv">def</span> <span class="nv">_from_dict</span><span class="ss">(</span><span class="nv">param_dict</span>: <span class="nv">Dict</span>[<span class="nv">str</span>, <span class="nv">object</span>]<span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">recreates a new agent instance according to the definition previously created by _to_dict.</span>

        <span class="nv">Returns</span>:

            <span class="nv">new</span> <span class="nv">agent</span> <span class="nv">instance</span> <span class="ss">(</span><span class="nv">excluding</span> <span class="nv">any</span> <span class="nv">trained</span> <span class="nv">policy</span><span class="ss">)</span>, <span class="nv">the</span> <span class="nv">agent</span> <span class="nv">type</span> <span class="nv">is</span> <span class="nv">preserved</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">param_dict</span>

        <span class="nv">mc</span>: <span class="nv">core</span>.<span class="nv">ModelConfig</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">ModelConfig</span>.<span class="nv">_from_dict</span><span class="ss">(</span><span class="nv">param_dict</span>[<span class="nv">EasyAgent</span>.<span class="nv">_KEY_MODEL_CONFIG</span>]<span class="ss">)</span>

        <span class="nv">agent_class</span> <span class="o">=</span> <span class="nv">globals</span><span class="ss">()</span>[<span class="nv">param_dict</span>[<span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_CLASS</span>]]

        <span class="nv">backend</span>: <span class="nv">str</span> <span class="o">=</span> <span class="nv">param_dict</span>[<span class="nv">EasyAgent</span>.<span class="nv">_KEY_BACKEND</span>]

        <span class="nb">result</span> <span class="o">=</span> <span class="nv">agent_class</span><span class="ss">(</span><span class="nv">gym_env_name</span><span class="o">=</span><span class="nv">mc</span>.<span class="nv">original_env_name</span><span class="ss">)</span>

        <span class="nb">result</span>.<span class="nv">_initialize</span><span class="ss">(</span><span class="nv">model_config</span><span class="o">=</span><span class="nv">mc</span>, <span class="nv">backend_name</span><span class="o">=</span><span class="nv">backend</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nb">result</span>

    <span class="nv">def</span> <span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">Optional</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>]]<span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">List</span>[

        <span class="nv">core</span>.<span class="nv">AgentCallback</span>]:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">maps callbacks to an admissible callback list.</span>

        <span class="k">if</span> <span class="nv">callbacks</span> <span class="nv">is</span> <span class="nv">None</span> <span class="nv">an</span> <span class="nv">empty</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">returned</span>.

        <span class="k">if</span> <span class="nv">callbacks</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">AgentCallback</span> <span class="nv">a</span> <span class="nv">list</span> <span class="nv">containing</span> <span class="nv">only</span> <span class="nv">this</span> <span class="nv">callback</span> <span class="nv">is</span> <span class="nv">returned</span>

        <span class="nv">otherwise</span> <span class="nv">callbacks</span> <span class="nv">is</span> <span class="nv">returned</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nb">result</span>: <span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>] <span class="o">=</span> []

        <span class="k">if</span> <span class="nv">not</span> <span class="nv">callbacks</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="k">if</span> <span class="nv">isinstance</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">core</span>.<span class="nv">AgentCallback</span><span class="ss">)</span>:

                <span class="nb">result</span> <span class="o">=</span> [<span class="nv">callbacks</span>]

            <span class="k">else</span>:

                <span class="nv">assert</span> <span class="nv">isinstance</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">list</span><span class="ss">)</span>, <span class="s2">&quot;</span><span class="s">callback not an AgentCallback or a list thereof.</span><span class="s2">&quot;</span>

                <span class="nb">result</span> <span class="o">=</span> <span class="nv">callbacks</span>

        <span class="k">return</span> <span class="nb">result</span>

    <span class="nv">def</span> <span class="nv">_to_dict</span><span class="ss">(</span><span class="nv">self</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">Dict</span>[<span class="nv">str</span>, <span class="nv">object</span>]:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">saves the agent definition to a dict.</span>

            <span class="nv">Returns</span>:

                <span class="nv">dict</span> <span class="nv">containing</span> <span class="nv">all</span> <span class="nv">parameters</span> <span class="nv">to</span> <span class="nv">recreate</span> <span class="nv">the</span> <span class="nv">agent</span> <span class="ss">(</span><span class="nv">excluding</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span><span class="ss">)</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nb">result</span>: <span class="nv">Dict</span>[<span class="nv">string</span>, <span class="nv">object</span>] <span class="o">=</span> <span class="nv">dict</span><span class="ss">()</span>

        <span class="nb">result</span>[<span class="nv">EasyAgent</span>.<span class="nv">_KEY_VERSION</span>] <span class="o">=</span> <span class="nv">easyagents</span>.<span class="nv">__version__</span>

        <span class="nb">result</span>[<span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_CLASS</span>] <span class="o">=</span> <span class="nv">self</span>.<span class="nv">__class__</span>.<span class="nv">__name__</span>

        <span class="nb">result</span>[<span class="nv">EasyAgent</span>.<span class="nv">_KEY_BACKEND</span>] <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_backend_name</span>

        <span class="nb">result</span>[<span class="nv">EasyAgent</span>.<span class="nv">_KEY_MODEL_CONFIG</span>] <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_model_config</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

        <span class="nb">result</span>[<span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span>] <span class="o">=</span> <span class="s1">&#39;</span><span class="s">policy</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="nb">result</span>

    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>

    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>

    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>

    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">TrainContext</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>],

              <span class="nv">default_plots</span>: <span class="nv">Optional</span>[<span class="nv">bool</span>]<span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span> <span class="ss">(</span><span class="nv">num_iterations</span>,<span class="nv">num_episodes_per_iteration</span>,...<span class="ss">)</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">train_context</span>, <span class="s2">&quot;</span><span class="s">train_context not set.</span><span class="s2">&quot;</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Loss</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>
</pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_4">Ancestors (in MRO)</h4>
<ul>
<li>abc.ABC</li>
</ul>
<h4 id="descendants_1">Descendants</h4>
<ul>
<li>easyagents.agents.CemAgent</li>
<li>easyagents.agents.DqnAgent</li>
<li>easyagents.agents.PpoAgent</li>
<li>easyagents.agents.RandomAgent</li>
<li>easyagents.agents.ReinforceAgent</li>
</ul>
<h4 id="methods_4">Methods</h4>
<h5 id="evaluate_4">evaluate</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy and computes metrics on rewards.</p>
<p>Args:
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode</p>
<p>Returns:
    extensible score metrics</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>
</pre></div>


</details>
<h5 id="play_4">play</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">play_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy.</p>
<p>Args:
    callbacks: list of callbacks called during each episode play
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode
    play_context: play configuration to be used. If set override all other play context arguments
    default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</p>
<p>Returns:
    play_context containg the actions taken and the rewards received during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>
</pre></div>


</details>
<h5 id="save_4">save</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</pre></div>


<p>Saves the currently trained actor policy in directory.</p>
<p>If save is called before a trained policy is created, eg by calling train, an exception is raised.</p>
<p>Args:
     directory: the directory to save the policy weights to.
        if the directory does not exist yet, a new directory is created. if None the policy is saved
        in a temp directory.
     callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Returns:
    the absolute path to the directory containing the saved policy.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>
</pre></div>


</details>
<h5 id="train_4">train</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">train_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">TrainContext</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">],</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>


<p>Trains a new model using the gym environment passed during instantiation.</p>
<p>Args:
    callbacks: list of callbacks called during the training and evaluation
    train_context: training configuration to be used (num_iterations,num_episodes_per_iteration,...)
    default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).
        if None default callbacks are only added if the callbacks list is empty</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">TrainContext</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>],

              <span class="nv">default_plots</span>: <span class="nv">Optional</span>[<span class="nv">bool</span>]<span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span> <span class="ss">(</span><span class="nv">num_iterations</span>,<span class="nv">num_episodes_per_iteration</span>,...<span class="ss">)</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">train_context</span>, <span class="s2">&quot;</span><span class="s">train_context not set.</span><span class="s2">&quot;</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Loss</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>
</pre></div>


</details>
<h3 id="ppoagent">PpoAgent</h3>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PpoAgent</span><span class="p">(</span>
    <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>creates a new agent based on the PPO algorithm.</p>
<p>PPO is an actor-critic algorithm using 2 neural networks. The actor network
to predict the next action to be taken and the critic network to estimate
the value of the game state we are currently in (the expected, discounted
sum of future rewards when following the current actor network).</p>
<p>see also: https://spinningup.openai.com/en/latest/algorithms/ppo.html</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nv">class</span> <span class="nv">PpoAgent</span><span class="ss">(</span><span class="nv">EasyAgent</span><span class="ss">)</span>:

    <span class="s2">&quot;&quot;&quot;</span><span class="s">creates a new agent based on the PPO algorithm.</span>

        <span class="nv">PPO</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">actor</span><span class="o">-</span><span class="nv">critic</span> <span class="nv">algorithm</span> <span class="nv">using</span> <span class="mi">2</span> <span class="nv">neural</span> <span class="nv">networks</span>. <span class="nv">The</span> <span class="nv">actor</span> <span class="nv">network</span>

        <span class="nv">to</span> <span class="nv">predict</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">action</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">critic</span> <span class="nv">network</span> <span class="nv">to</span> <span class="nv">estimate</span>

        <span class="nv">the</span> <span class="nv">value</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">game</span> <span class="nv">state</span> <span class="nv">we</span> <span class="nv">are</span> <span class="nv">currently</span> <span class="nv">in</span> <span class="ss">(</span><span class="nv">the</span> <span class="nv">expected</span>, <span class="nv">discounted</span>

        <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">future</span> <span class="nv">rewards</span> <span class="nv">when</span> <span class="nv">following</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">actor</span> <span class="nv">network</span><span class="ss">)</span>.

        <span class="nv">see</span> <span class="nv">also</span>: <span class="nv">https</span>:<span class="o">//</span><span class="nv">spinningup</span>.<span class="nv">openai</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">en</span><span class="o">/</span><span class="nv">latest</span><span class="o">/</span><span class="nv">algorithms</span><span class="o">/</span><span class="nv">ppo</span>.<span class="nv">html</span>

    <span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">100</span>,

              <span class="nv">num_episodes_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">num_epochs_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">5</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">learning_rate</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">001</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">PpoTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">num_episodes_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">per</span> <span class="nv">training</span> <span class="nv">iteration</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_epochs_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">data</span> <span class="nv">collected</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">iteration</span>

                <span class="nv">is</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">retrain</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span>

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">learning_rate</span>: <span class="nv">the</span> <span class="nv">learning</span> <span class="nv">rate</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">iteration</span><span class="s1">&#39;</span><span class="s">s policy training (0,1]</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PpoTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_iteration</span> <span class="o">=</span> <span class="nv">num_episodes_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_epochs_per_iteration</span> <span class="o">=</span> <span class="nv">num_epochs_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="nv">learning_rate</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_5">Ancestors (in MRO)</h4>
<ul>
<li>easyagents.agents.EasyAgent</li>
<li>abc.ABC</li>
</ul>
<h4 id="methods_5">Methods</h4>
<h5 id="evaluate_5">evaluate</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy and computes metrics on rewards.</p>
<p>Args:
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode</p>
<p>Returns:
    extensible score metrics</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>
</pre></div>


</details>
<h5 id="play_5">play</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">play_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy.</p>
<p>Args:
    callbacks: list of callbacks called during each episode play
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode
    play_context: play configuration to be used. If set override all other play context arguments
    default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</p>
<p>Returns:
    play_context containg the actions taken and the rewards received during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>
</pre></div>


</details>
<h5 id="save_5">save</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</pre></div>


<p>Saves the currently trained actor policy in directory.</p>
<p>If save is called before a trained policy is created, eg by calling train, an exception is raised.</p>
<p>Args:
     directory: the directory to save the policy weights to.
        if the directory does not exist yet, a new directory is created. if None the policy is saved
        in a temp directory.
     callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Returns:
    the absolute path to the directory containing the saved policy.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>
</pre></div>


</details>
<h5 id="train_5">train</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">num_episodes_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">num_epochs_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">train_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PpoTrainContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Trains a new model using the gym environment passed during instantiation.</p>
<p>Args:
    callbacks: list of callbacks called during training and evaluation
    num_iterations: number of times the training is repeated (with additional data)
    num_episodes_per_iteration: number of episodes played per training iteration
    max_steps_per_episode: maximum number of steps per episode
    num_epochs_per_iteration: number of times the data collected for the current iteration
        is used to retrain the current policy
    num_iterations_between_eval: number of training iterations before the current policy is evaluated.
        if 0 no evaluation is performed.
    num_episodes_per_eval: number of episodes played to estimate the average return and steps
    learning_rate: the learning rate used in the next iteration's policy training (0,1]
    train_context: training configuration to be used. if set overrides all other training context arguments.
    default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).
        if None default callbacks are only added if the callbacks list is empty</p>
<p>Returns:
    train_context: the training configuration containing the loss and sum of rewards encountered
        during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">100</span>,

              <span class="nv">num_episodes_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">num_epochs_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">5</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">learning_rate</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">001</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">PpoTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">num_episodes_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">per</span> <span class="nv">training</span> <span class="nv">iteration</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_epochs_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">data</span> <span class="nv">collected</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">iteration</span>

                <span class="nv">is</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">retrain</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span>

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">learning_rate</span>: <span class="nv">the</span> <span class="nv">learning</span> <span class="nv">rate</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">iteration</span><span class="s1">&#39;</span><span class="s">s policy training (0,1]</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PpoTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_iteration</span> <span class="o">=</span> <span class="nv">num_episodes_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_epochs_per_iteration</span> <span class="o">=</span> <span class="nv">num_epochs_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="nv">learning_rate</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<h3 id="randomagent">RandomAgent</h3>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">RandomAgent</span><span class="p">(</span>
    <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Agent which always chooses uniform random actions.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nv">class</span> <span class="nv">RandomAgent</span><span class="ss">(</span><span class="nv">EasyAgent</span><span class="ss">)</span>:

    <span class="s2">&quot;&quot;&quot;</span><span class="s">Agent which always chooses uniform random actions.</span><span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">TrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Evaluates the environment using a uniform random policy.</span>

        <span class="nv">The</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span> <span class="nv">in</span> <span class="nv">batches</span> <span class="nv">of</span> <span class="nv">num_episodes_per_eval</span> <span class="nv">episodes</span>.

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">a</span> <span class="nv">batch</span> <span class="nv">of</span> <span class="nv">num_episodes_per_eval</span> <span class="nv">episodes</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">TrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_epochs_per_iteration</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_6">Ancestors (in MRO)</h4>
<ul>
<li>easyagents.agents.EasyAgent</li>
<li>abc.ABC</li>
</ul>
<h4 id="methods_6">Methods</h4>
<h5 id="evaluate_6">evaluate</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy and computes metrics on rewards.</p>
<p>Args:
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode</p>
<p>Returns:
    extensible score metrics</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>
</pre></div>


</details>
<h5 id="play_6">play</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">play_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy.</p>
<p>Args:
    callbacks: list of callbacks called during each episode play
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode
    play_context: play configuration to be used. If set override all other play context arguments
    default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</p>
<p>Returns:
    play_context containg the actions taken and the rewards received during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>
</pre></div>


</details>
<h5 id="save_6">save</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</pre></div>


<p>Saves the currently trained actor policy in directory.</p>
<p>If save is called before a trained policy is created, eg by calling train, an exception is raised.</p>
<p>Args:
     directory: the directory to save the policy weights to.
        if the directory does not exist yet, a new directory is created. if None the policy is saved
        in a temp directory.
     callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Returns:
    the absolute path to the directory containing the saved policy.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>
</pre></div>


</details>
<h5 id="train_6">train</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">train_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">TrainContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Evaluates the environment using a uniform random policy.</p>
<p>The evaluation is performed in batches of num_episodes_per_eval episodes.</p>
<p>Args:
    callbacks: list of callbacks called during training and evaluation
    num_iterations: number of times a batch of num_episodes_per_eval episodes is evaluated.
    max_steps_per_episode: maximum number of steps per episode
    num_episodes_per_eval: number of episodes played to estimate the average return and steps
    train_context: training configuration to be used. if set overrides all other training context arguments.
    default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...)</p>
<p>Returns:
    train_context: the training configuration containing the loss and sum of rewards encountered
        during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">TrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Evaluates the environment using a uniform random policy.</span>

        <span class="nv">The</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span> <span class="nv">in</span> <span class="nv">batches</span> <span class="nv">of</span> <span class="nv">num_episodes_per_eval</span> <span class="nv">episodes</span>.

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">a</span> <span class="nv">batch</span> <span class="nv">of</span> <span class="nv">num_episodes_per_eval</span> <span class="nv">episodes</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">TrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_epochs_per_iteration</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<h3 id="reinforceagent">ReinforceAgent</h3>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ReinforceAgent</span><span class="p">(</span>
    <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>creates a new agent based on the Reinforce algorithm.</p>
<p>Reinforce is a vanilla policy gradient algorithm using a single actor network.</p>
<p>see also: www-anw.cs.umass.edu/~barto/courses/cs687/williams92simple.pdf</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="nv">class</span> <span class="nv">ReinforceAgent</span><span class="ss">(</span><span class="nv">EasyAgent</span><span class="ss">)</span>:

    <span class="s2">&quot;&quot;&quot;</span><span class="s">creates a new agent based on the Reinforce algorithm.</span>

        <span class="nv">Reinforce</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">vanilla</span> <span class="nv">policy</span> <span class="nv">gradient</span> <span class="nv">algorithm</span> <span class="nv">using</span> <span class="nv">a</span> <span class="nv">single</span> <span class="nv">actor</span> <span class="nv">network</span>.

        <span class="nv">see</span> <span class="nv">also</span>: <span class="nv">www</span><span class="o">-</span><span class="nv">anw</span>.<span class="nv">cs</span>.<span class="nv">umass</span>.<span class="nv">edu</span><span class="o">/~</span><span class="nv">barto</span><span class="o">/</span><span class="nv">courses</span><span class="o">/</span><span class="nv">cs687</span><span class="o">/</span><span class="nv">williams92simple</span>.<span class="nv">pdf</span>

    <span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">100</span>,

              <span class="nv">num_episodes_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">num_epochs_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">5</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">learning_rate</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">001</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">EpisodesTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">num_episodes_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">per</span> <span class="nv">training</span> <span class="nv">iteration</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_epochs_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">data</span> <span class="nv">collected</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">iteration</span>

                <span class="nv">is</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">retrain</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span>

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">learning_rate</span>: <span class="nv">the</span> <span class="nv">learning</span> <span class="nv">rate</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">iteration</span><span class="s1">&#39;</span><span class="s">s policy training (0,1]</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">EpisodesTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_iteration</span> <span class="o">=</span> <span class="nv">num_episodes_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_epochs_per_iteration</span> <span class="o">=</span> <span class="nv">num_epochs_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="nv">learning_rate</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_7">Ancestors (in MRO)</h4>
<ul>
<li>easyagents.agents.EasyAgent</li>
<li>abc.ABC</li>
</ul>
<h4 id="methods_7">Methods</h4>
<h5 id="evaluate_7">evaluate</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy and computes metrics on rewards.</p>
<p>Args:
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode</p>
<p>Returns:
    extensible score metrics</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>
</pre></div>


</details>
<h5 id="play_7">play</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">play_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy.</p>
<p>Args:
    callbacks: list of callbacks called during each episode play
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode
    play_context: play configuration to be used. If set override all other play context arguments
    default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</p>
<p>Returns:
    play_context containg the actions taken and the rewards received during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>
</pre></div>


</details>
<h5 id="save_7">save</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</pre></div>


<p>Saves the currently trained actor policy in directory.</p>
<p>If save is called before a trained policy is created, eg by calling train, an exception is raised.</p>
<p>Args:
     directory: the directory to save the policy weights to.
        if the directory does not exist yet, a new directory is created. if None the policy is saved
        in a temp directory.
     callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Returns:
    the absolute path to the directory containing the saved policy.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>
</pre></div>


</details>
<h5 id="train_7">train</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">num_episodes_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">num_epochs_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">train_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">EpisodesTrainContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Trains a new model using the gym environment passed during instantiation.</p>
<p>Args:
    callbacks: list of callbacks called during training and evaluation
    num_iterations: number of times the training is repeated (with additional data)
    num_episodes_per_iteration: number of episodes played per training iteration
    max_steps_per_episode: maximum number of steps per episode
    num_epochs_per_iteration: number of times the data collected for the current iteration
        is used to retrain the current policy
    num_iterations_between_eval: number of training iterations before the current policy is evaluated.
        if 0 no evaluation is performed.
    num_episodes_per_eval: number of episodes played to estimate the average return and steps
    learning_rate: the learning rate used in the next iteration's policy training (0,1]
    train_context: training configuration to be used. if set overrides all other training context arguments.
    default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).
        if None default callbacks are only added if the callbacks list is empty</p>
<p>Returns:
    train_context: the training configuration containing the loss and sum of rewards encountered
        during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">100</span>,

              <span class="nv">num_episodes_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">num_epochs_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">5</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">learning_rate</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">001</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">EpisodesTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">num_episodes_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">per</span> <span class="nv">training</span> <span class="nv">iteration</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_epochs_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">data</span> <span class="nv">collected</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">iteration</span>

                <span class="nv">is</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">retrain</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span>

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">learning_rate</span>: <span class="nv">the</span> <span class="nv">learning</span> <span class="nv">rate</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">iteration</span><span class="s1">&#39;</span><span class="s">s policy training (0,1]</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">EpisodesTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_iteration</span> <span class="o">=</span> <span class="nv">num_episodes_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_epochs_per_iteration</span> <span class="o">=</span> <span class="nv">num_epochs_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="nv">learning_rate</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
<h3 id="sacagent">SacAgent</h3>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">SacAgent</span><span class="p">(</span>
    <span class="n">gym_env_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fc_layers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Agent based on the Soft-Actor-Critic algorithm (https://arxiv.org/abs/1812.05905).</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><span class="k">class</span> <span class="n">SacAgent</span>(<span class="n">DqnAgent</span>):

    <span class="s">&quot;&quot;&quot;Agent based on the Soft-Actor-Critic algorithm (https://arxiv.org/abs/1812.05905).&quot;&quot;&quot;</span>
</pre></div>


</details>
<hr />
<h4 id="ancestors-in-mro_8">Ancestors (in MRO)</h4>
<ul>
<li>easyagents.agents.DqnAgent</li>
<li>easyagents.agents.EasyAgent</li>
<li>abc.ABC</li>
</ul>
<h4 id="methods_8">Methods</h4>
<h5 id="evaluate_8">evaluate</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy and computes metrics on rewards.</p>
<p>Args:
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode</p>
<p>Returns:
    extensible score metrics</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">evaluate</span><span class="ss">(</span><span class="nv">self</span>,

                 <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span>,

                 <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">50</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy and computes metrics on rewards.</span>

        <span class="nv">Args</span>:

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

        <span class="nv">Returns</span>:

            <span class="nv">extensible</span> <span class="nv">score</span> <span class="nv">metrics</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

        <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

        <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">self</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">False</span><span class="ss">)</span>

        <span class="nv">Metrics</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Metrics</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">steps rewards</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">Rewards</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Rewards</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_rewards</span> <span class="o">=</span> <span class="nv">list</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">sum_of_rewards</span>.<span class="nv">values</span><span class="ss">())</span>

        <span class="nv">mean_reward</span>, <span class="nv">std_reward</span>, <span class="nv">min_reward</span>, <span class="nv">max_reward</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">rewards</span> <span class="o">=</span> <span class="nv">Rewards</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_reward</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_reward</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_reward</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_reward</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_rewards</span><span class="ss">)</span>

        <span class="nv">Steps</span> <span class="o">=</span> <span class="nv">namedtuple</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">Steps</span><span class="s1">&#39;</span>, <span class="s1">&#39;</span><span class="s">mean std min max all</span><span class="s1">&#39;</span><span class="ss">)</span>

        <span class="nv">all_num_steps</span> <span class="o">=</span> []

        <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">play_context</span>.<span class="nv">rewards</span>.<span class="nv">keys</span><span class="ss">()</span>:

            <span class="nv">all_num_steps</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">len</span><span class="ss">(</span><span class="nv">play_context</span>.<span class="nv">rewards</span>[<span class="nv">i</span>]<span class="ss">))</span>

        <span class="nv">mean_steps</span>, <span class="nv">std_steps</span>, <span class="nv">min_steps</span>, <span class="nv">max_steps</span> <span class="o">=</span> <span class="nv">statistics</span>.<span class="nv">mean</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">statistics</span>.<span class="nv">stdev</span><span class="ss">(</span>

            <span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">min</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>, <span class="nv">max</span><span class="ss">(</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">steps</span> <span class="o">=</span> <span class="nv">Steps</span><span class="ss">(</span><span class="nv">mean</span><span class="o">=</span><span class="nv">mean_steps</span>, <span class="nv">std</span><span class="o">=</span><span class="nv">std_steps</span>, <span class="nv">min</span><span class="o">=</span><span class="nv">min_steps</span>, <span class="nv">max</span><span class="o">=</span><span class="nv">max_steps</span>, <span class="nv">all</span><span class="o">=</span><span class="nv">all_num_steps</span><span class="ss">)</span>

        <span class="nv">metrics</span> <span class="o">=</span> <span class="nv">Metrics</span><span class="ss">(</span><span class="nv">rewards</span><span class="o">=</span><span class="nv">rewards</span>, <span class="nv">steps</span><span class="o">=</span><span class="nv">steps</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">metrics</span>
</pre></div>


</details>
<h5 id="play_8">play</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">play</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_episodes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">play_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PlayContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Plays num_episodes with the current policy.</p>
<p>Args:
    callbacks: list of callbacks called during each episode play
    num_episodes: number of episodes to play
    max_steps_per_episode: max steps per episode
    play_context: play configuration to be used. If set override all other play context arguments
    default_plots: if set addes a set of default callbacks (plot.State, plot.Rewards, ...)</p>
<p>Returns:
    play_context containg the actions taken and the rewards received during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">play</span><span class="ss">(</span><span class="nv">self</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">num_episodes</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

             <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

             <span class="nv">play_context</span>: <span class="nv">core</span>.<span class="nv">PlayContext</span> <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Plays num_episodes with the current policy.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">each</span> <span class="nv">episode</span> <span class="nv">play</span>

            <span class="nv">num_episodes</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">to</span> <span class="nv">play</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">max</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">play_context</span>: <span class="nv">play</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">If</span> <span class="nv">set</span> <span class="nv">override</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">play</span> <span class="nv">context</span> <span class="nv">arguments</span>

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">addes</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, ...<span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">play_context</span> <span class="nv">containg</span> <span class="nv">the</span> <span class="nv">actions</span> <span class="nv">taken</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">rewards</span> <span class="nv">received</span> <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nv">play_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">play_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">PlayContext</span><span class="ss">()</span>

            <span class="nv">play_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">play_context</span>.<span class="nv">num_episodes</span> <span class="o">=</span> <span class="nv">num_episodes</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_add_plot_callbacks</span><span class="ss">(</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span>, [<span class="nv">plot</span>.<span class="nv">Steps</span><span class="ss">()</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span><span class="ss">()</span>]<span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">play</span><span class="ss">(</span><span class="nv">play_context</span><span class="o">=</span><span class="nv">play_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">play_context</span>
</pre></div>


</details>
<h5 id="save_8">save</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">directory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</pre></div>


<p>Saves the currently trained actor policy in directory.</p>
<p>If save is called before a trained policy is created, eg by calling train, an exception is raised.</p>
<p>Args:
     directory: the directory to save the policy weights to.
        if the directory does not exist yet, a new directory is created. if None the policy is saved
        in a temp directory.
     callbacks: list of callbacks called during save (eg log.Agent)</p>
<p>Returns:
    the absolute path to the directory containing the saved policy.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">save</span><span class="ss">(</span><span class="nv">self</span>, <span class="nv">directory</span>: <span class="nv">Optional</span>[<span class="nv">str</span>] <span class="o">=</span> <span class="nv">None</span>,

             <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span> <span class="o">-&gt;</span> <span class="nv">str</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Saves the currently trained actor policy in directory.</span>

        <span class="k">If</span> <span class="nv">save</span> <span class="nv">is</span> <span class="nv">called</span> <span class="nv">before</span> <span class="nv">a</span> <span class="nv">trained</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">created</span>, <span class="nv">eg</span> <span class="nv">by</span> <span class="nv">calling</span> <span class="nv">train</span>, <span class="nv">an</span> <span class="nv">exception</span> <span class="nv">is</span> <span class="nv">raised</span>.

        <span class="nv">Args</span>:

             <span class="nv">directory</span>: <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">to</span> <span class="nv">save</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">weights</span> <span class="nv">to</span>.

                <span class="k">if</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">does</span> <span class="nv">not</span> <span class="nv">exist</span> <span class="nv">yet</span>, <span class="nv">a</span> <span class="nv">new</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">created</span>. <span class="k">if</span> <span class="nv">None</span> <span class="nv">the</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">saved</span>

                <span class="nv">in</span> <span class="nv">a</span> <span class="nv">temp</span> <span class="nv">directory</span>.

             <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">save</span> <span class="ss">(</span><span class="nv">eg</span> <span class="nv">log</span>.<span class="nv">Agent</span><span class="ss">)</span>

        <span class="nv">Returns</span>:

            <span class="nv">the</span> <span class="nv">absolute</span> <span class="nv">path</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">directory</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">saved</span> <span class="nv">policy</span>.

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">directory</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_get_temp_path</span><span class="ss">()</span>

        <span class="nv">assert</span> <span class="nv">directory</span>

        <span class="nv">assert</span> <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">_agent_context</span>.<span class="nv">_is_policy_trained</span>, <span class="s2">&quot;</span><span class="s">No trained policy available. Call train() first.</span><span class="s2">&quot;</span>

        <span class="nv">directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">directory</span><span class="ss">)</span>

        <span class="nv">agent_json_path</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_EASYAGENT_FILENAME</span><span class="ss">)</span>

        <span class="nv">with</span> <span class="nv">open</span><span class="ss">(</span><span class="nv">agent_json_path</span>, <span class="s1">&#39;</span><span class="s">w</span><span class="s1">&#39;</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">jsonfile</span>:

            <span class="nv">agent_dict</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_dict</span><span class="ss">()</span>

            <span class="nv">json</span>.<span class="nv">dump</span><span class="ss">(</span><span class="nv">agent_dict</span>, <span class="nv">jsonfile</span>, <span class="nv">sort_keys</span><span class="o">=</span><span class="nv">True</span>, <span class="nv">indent</span><span class="o">=</span><span class="mi">2</span><span class="ss">)</span>

        <span class="nv">callbacks</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">_to_callback_list</span><span class="ss">(</span><span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">os</span>.<span class="nv">path</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">directory</span>, <span class="nv">EasyAgent</span>.<span class="nv">_KEY_POLICY_DIRECTORY</span><span class="ss">)</span>

        <span class="nv">policy_directory</span> <span class="o">=</span> <span class="nv">bcore</span>.<span class="nv">_mkdir</span><span class="ss">(</span><span class="nv">policy_directory</span><span class="ss">)</span>

        <span class="nv">self</span>.<span class="nv">_backend_agent</span>.<span class="nv">save</span><span class="ss">(</span><span class="nv">directory</span><span class="o">=</span><span class="nv">policy_directory</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">directory</span>
</pre></div>


</details>
<h5 id="train_8">train</h5>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">],</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">AgentCallback</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>
    <span class="n">max_steps_per_episode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">num_steps_per_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">num_iterations_between_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">num_episodes_per_eval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">train_context</span><span class="p">:</span> <span class="n">easyagents</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StepsTrainContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>


<p>Trains a new model using the gym environment passed during instantiation.</p>
<p>Args:
    callbacks: list of callbacks called during training and evaluation
    num_iterations: number of times the training is repeated (with additional data)
    max_steps_per_episode: maximum number of steps per episode
    num_steps_per_iteration: number of steps played per training iteration
    num_steps_buffer_preload: number of initial collect steps to preload the buffer
    num_steps_sampled_from_buffer: the number of steps sampled from buffer for each iteration training
    num_iterations_between_eval: number of training iterations before the current policy is evaluated.
        if 0 no evaluation is performed.
    num_episodes_per_eval: number of episodes played to estimate the average return and steps
    learning_rate: the learning rate used in the next iteration's policy training (0,1]
    train_context: training configuration to be used. if set overrides all other training context arguments.
    default_plots: if set adds a set of default callbacks (plot.State, plot.Rewards, plot.Loss,...).
        if None default callbacks are only added if the callbacks list is empty</p>
<p>Returns:
    train_context: the training configuration containing the loss and sum of rewards encountered
        during training</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span>    <span class="nv">def</span> <span class="nv">train</span><span class="ss">(</span><span class="nv">self</span>,

              <span class="nv">callbacks</span>: <span class="nv">Union</span>[<span class="nv">List</span>[<span class="nv">core</span>.<span class="nv">AgentCallback</span>], <span class="nv">core</span>.<span class="nv">AgentCallback</span>, <span class="nv">None</span>] <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">num_iterations</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">20000</span>,

              <span class="nv">max_steps_per_episode</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">500</span>,

              <span class="nv">num_steps_per_iteration</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1</span>,

              <span class="nv">num_steps_buffer_preload</span><span class="o">=</span><span class="mi">1000</span>,

              <span class="nv">num_steps_sampled_from_buffer</span><span class="o">=</span><span class="mi">64</span>,

              <span class="nv">num_iterations_between_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">1000</span>,

              <span class="nv">num_episodes_per_eval</span>: <span class="nv">int</span> <span class="o">=</span> <span class="mi">10</span>,

              <span class="nv">learning_rate</span>: <span class="nv">float</span> <span class="o">=</span> <span class="mi">0</span>.<span class="mi">001</span>,

              <span class="nv">train_context</span>: <span class="nv">core</span>.<span class="nv">StepsTrainContext</span> <span class="o">=</span> <span class="nv">None</span>,

              <span class="nv">default_plots</span>: <span class="nv">bool</span> <span class="o">=</span> <span class="nv">None</span><span class="ss">)</span>:

        <span class="s2">&quot;&quot;&quot;</span><span class="s">Trains a new model using the gym environment passed during instantiation.</span>

        <span class="nv">Args</span>:

            <span class="nv">callbacks</span>: <span class="nv">list</span> <span class="nv">of</span> <span class="nv">callbacks</span> <span class="nv">called</span> <span class="nv">during</span> <span class="nv">training</span> <span class="nv">and</span> <span class="nv">evaluation</span>

            <span class="nv">num_iterations</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">times</span> <span class="nv">the</span> <span class="nv">training</span> <span class="nv">is</span> <span class="nv">repeated</span> <span class="ss">(</span><span class="nv">with</span> <span class="nv">additional</span> <span class="nv">data</span><span class="ss">)</span>

            <span class="nv">max_steps_per_episode</span>: <span class="nv">maximum</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">per</span> <span class="nv">episode</span>

            <span class="nv">num_steps_per_iteration</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">played</span> <span class="nv">per</span> <span class="nv">training</span> <span class="nv">iteration</span>

            <span class="nv">num_steps_buffer_preload</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">initial</span> <span class="nv">collect</span> <span class="nv">steps</span> <span class="nv">to</span> <span class="nv">preload</span> <span class="nv">the</span> <span class="nv">buffer</span>

            <span class="nv">num_steps_sampled_from_buffer</span>: <span class="nv">the</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">steps</span> <span class="nv">sampled</span> <span class="nv">from</span> <span class="nv">buffer</span> <span class="k">for</span> <span class="nv">each</span> <span class="nv">iteration</span> <span class="nv">training</span>

            <span class="nv">num_iterations_between_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">training</span> <span class="nv">iterations</span> <span class="nv">before</span> <span class="nv">the</span> <span class="nv">current</span> <span class="nv">policy</span> <span class="nv">is</span> <span class="nv">evaluated</span>.

                <span class="k">if</span> <span class="mi">0</span> <span class="nv">no</span> <span class="nv">evaluation</span> <span class="nv">is</span> <span class="nv">performed</span>.

            <span class="nv">num_episodes_per_eval</span>: <span class="nv">number</span> <span class="nv">of</span> <span class="nv">episodes</span> <span class="nv">played</span> <span class="nv">to</span> <span class="nv">estimate</span> <span class="nv">the</span> <span class="nv">average</span> <span class="k">return</span> <span class="nv">and</span> <span class="nv">steps</span>

            <span class="nv">learning_rate</span>: <span class="nv">the</span> <span class="nv">learning</span> <span class="nv">rate</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="k">next</span> <span class="nv">iteration</span><span class="s1">&#39;</span><span class="s">s policy training (0,1]</span>

            <span class="nv">train_context</span>: <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">used</span>. <span class="k">if</span> <span class="nv">set</span> <span class="nv">overrides</span> <span class="nv">all</span> <span class="nv">other</span> <span class="nv">training</span> <span class="nv">context</span> <span class="nv">arguments</span>.

            <span class="nv">default_plots</span>: <span class="k">if</span> <span class="nv">set</span> <span class="nv">adds</span> <span class="nv">a</span> <span class="nv">set</span> <span class="nv">of</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="ss">(</span><span class="nv">plot</span>.<span class="nv">State</span>, <span class="nv">plot</span>.<span class="nv">Rewards</span>, <span class="nv">plot</span>.<span class="nv">Loss</span>,...<span class="ss">)</span>.

                <span class="k">if</span> <span class="nv">None</span> <span class="nv">default</span> <span class="nv">callbacks</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">added</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">callbacks</span> <span class="nv">list</span> <span class="nv">is</span> <span class="nv">empty</span>

        <span class="nv">Returns</span>:

            <span class="nv">train_context</span>: <span class="nv">the</span> <span class="nv">training</span> <span class="nv">configuration</span> <span class="nv">containing</span> <span class="nv">the</span> <span class="nv">loss</span> <span class="nv">and</span> <span class="nv">sum</span> <span class="nv">of</span> <span class="nv">rewards</span> <span class="nv">encountered</span>

                <span class="nv">during</span> <span class="nv">training</span>

        <span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nv">train_context</span> <span class="nv">is</span> <span class="nv">None</span>:

            <span class="nv">train_context</span> <span class="o">=</span> <span class="nv">core</span>.<span class="nv">StepsTrainContext</span><span class="ss">()</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations</span> <span class="o">=</span> <span class="nv">num_iterations</span>

            <span class="nv">train_context</span>.<span class="nv">max_steps_per_episode</span> <span class="o">=</span> <span class="nv">max_steps_per_episode</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_per_iteration</span> <span class="o">=</span> <span class="nv">num_steps_per_iteration</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_buffer_preload</span> <span class="o">=</span> <span class="nv">num_steps_buffer_preload</span>

            <span class="nv">train_context</span>.<span class="nv">num_steps_sampled_from_buffer</span> <span class="o">=</span> <span class="nv">num_steps_sampled_from_buffer</span>

            <span class="nv">train_context</span>.<span class="nv">num_iterations_between_eval</span> <span class="o">=</span> <span class="nv">num_iterations_between_eval</span>

            <span class="nv">train_context</span>.<span class="nv">num_episodes_per_eval</span> <span class="o">=</span> <span class="nv">num_episodes_per_eval</span>

            <span class="nv">train_context</span>.<span class="nv">learning_rate</span> <span class="o">=</span> <span class="nv">learning_rate</span>

        <span class="nv">super</span><span class="ss">()</span>.<span class="nv">train</span><span class="ss">(</span><span class="nv">train_context</span><span class="o">=</span><span class="nv">train_context</span>, <span class="nv">callbacks</span><span class="o">=</span><span class="nv">callbacks</span>, <span class="nv">default_plots</span><span class="o">=</span><span class="nv">default_plots</span><span class="ss">)</span>

        <span class="k">return</span> <span class="nv">train_context</span>
</pre></div>


</details>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../documentation/markdown/Release_Notes/" title="Release Notes" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Release Notes
              </span>
            </div>
          </a>
        
        
          <a href="../core/" title="Core" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Core
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>